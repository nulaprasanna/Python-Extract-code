ETL Name:	wf_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT.XML


Session 1: 	s_m_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT
Mapping 1: 	m_WK_DRVD_NCR_REV_TRX_FOR_BKG_RTm_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT


Source1 Name : SQ_WI_DRVD_NCR_REV_TRX_BKG_RT_OA


Pre SQL : 



SQL Query : 
SELECT 
  WDRT.TRANSACTION_SEQUENCE_ID_INT  ,
  WDRT.SOURCE_SYSTEM_CODE      ,
  NRT.REVENUE_TRANSFER_KEY   ,
  CASE WHEN NRT.TRANSACTION_SOURCE_CD = 'ERP' THEN CASE WHEN NRT.ATTRBTN_CD='STANDALONE' THEN NRT.RU_SALES_ORDER_LINE_KEY ELSE NRT.DV_ATTRBTN_PRNT_SLSORD_LN_KEY
  END ELSE -7777 END AS DV_SALES_ORDER_LINE_KEY  ,
  NRT.OFFER_ATTRBTN_ID_INT AS SK_OFFER_ATTRIBUTION_ID_INT ,
  CASE WHEN NRT.ATTRBTN_CD ='STANDALONE' THEN  WDRT.PRODUCT_KEY  ELSE  NATIL1.PRODUCT_KEY   END  DV_PRODUCT_KEY,
  NRT.ATTRBTN_CD AS DV_ATTRIBUTION_CD  
,NRT.POB_TYPE_CD /*NRS MPOB Change */  
  FROM 
  $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT WDRT
  INNER JOIN $$FINLGLVWDB.N_REVENUE_TRANSFER NRT
  ON WDRT.REVENUE_TRANSFER_KEY=NRT.REVENUE_TRANSFER_KEY
  INNER JOIN $$FINLGLVWDB.N_AR_TRX_ITEM_LINE NATIL
  ON WDRT.AR_TRX_LINE_KEY=NATIL.AR_TRX_LINE_KEY                            
  INNER JOIN $$FINLGLVWDB.N_AR_TRX_ITEM_LINE NATIL1
  ON NATIL1.AR_TRX_LINE_KEY=NATIL.RU_PARENT_AR_TRX_LINE_KEY


Post SQL : 



Target1 Name : WI_DRVD_NCR_REV_TRX_BKG_RT_OA1


Pre SQL : 
DELETE FROM $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_RT_OA ALL;


Post SQL : 
CALL COLLECT_STATS_WRAP('$$STGDB','WI_DRVD_NCR_REV_TRX_BKG_RT_OA','D');


Source2 Name : SQ_WI_DRVD_NCR_REV_FOR_BKGB_RT


Pre SQL : 



SQL Query : 
SELECT
 DRVD_NCR_REV_TRX_BKG_KEY
 ,ROW_NUMBER() OVER (ORDER BY BNDL_OFFSET.TRANSACTION_SEQUENCE_ID_INT, BNDL_OFFSET.SOURCE_SYSTEM_CODE ) + SM_MAX.TRANSACTION_SEQUENCE_ID_INT AS TRANSACTION_SEQUENCE_ID_INT
   ,BNDL_OFFSET.SOURCE_SYSTEM_CODE
   ,BNDL_OFFSET.TRANSACTION_DATE
   ,BNDL_OFFSET.SK_PH_TRANSACTION_SEQ_ID_INT
   ,BNDL_OFFSET.PD_ACCOUNTING_RULE_NAME
   ,BNDL_OFFSET.ACCOUNT_CLASS_CODE
   ,BNDL_OFFSET.GL_DISTRIBUTION_FUNCTIONAL_AMT
   ,BNDL_OFFSET.ADJUSTMENT_TYPE_CODE
   ,BNDL_OFFSET.GL_DISTRIB_TRANSACTIONAL_AMT
   ,BNDL_OFFSET.CREATED_BY_INT
   ,BNDL_OFFSET.AR_TRX_LINE_TRANSACTIONAL_AMT
   ,BNDL_OFFSET.EXTRACT_TYPE_CODE
   ,BNDL_OFFSET.FORWARD_REVERSE_CODE
   ,BNDL_OFFSET.GL_DATETIME
   ,BNDL_OFFSET.GL_DATE
   ,BNDL_OFFSET.GL_POSTED_DATE
   ,BNDL_OFFSET.TRANSACTION_GROUPING_TYPE_CODE
   ,BNDL_OFFSET.LAST_UPDATED_BY_INT
   ,BNDL_OFFSET.LAST_RECORD_FLAG
   ,BNDL_OFFSET.LINE_TYPE_CODE
   ,BNDL_OFFSET.QUOTA_FLAG
   ,BNDL_OFFSET.REBATE_TRANSACTIONAL_AMOUNT
   ,BNDL_OFFSET.MANUAL_TRANSACTION_FLAG
   ,BNDL_OFFSET.RULE_START_DATETIME
   ,BNDL_OFFSET.TRANSACTION_DATETIME
   ,BNDL_OFFSET.TRANSACTION_QUANTITY
   ,BNDL_OFFSET.AR_TRX_DATETIME
   ,BNDL_OFFSET.AR_TRX_NUMBER
   ,BNDL_OFFSET.AR_TRX_TYPE_CODE
   ,BNDL_OFFSET.UNIT_SELLING_PRICE_TRX_AMT
   ,BNDL_OFFSET.UNIT_STANDARD_PRICE_TRX_AMT
   ,BNDL_OFFSET.PD_SALES_TERRITORY_KEY
   ,BNDL_OFFSET.PD_SALES_REP_NUMBER
   ,BNDL_OFFSET.PD_AR_ADJUSTMENT_NUMBER
   ,BNDL_OFFSET.PD_AR_ADJUSTMENT_COMPANY_CODE
   ,BNDL_OFFSET.PD_AR_ADJ_SET_OF_BOOKS_KEY
   ,BNDL_OFFSET.PD_FUNCTIONAL_CURRENCY_CODE
   ,BNDL_OFFSET.PD_INVOICE_CURRENCY_CODE
   ,BNDL_OFFSET.DV_FISCAL_CALENDAR_CODE
   ,BNDL_OFFSET.DV_FISCAL_MONTH_NUMBER_INT
   ,BNDL_OFFSET.DV_FISCAL_YEAR_NUMBER_INT
   ,BNDL_OFFSET.REPORTING_MEASURE_TYPE
   ,BNDL_OFFSET.BK_AR_TRX_LINE_GL_DISTRIB_KEY
   ,BNDL_OFFSET.REVENUE_TRANSFER_KEY
   ,BNDL_OFFSET.DV_FISCAL_DATE
   ,BNDL_OFFSET.DV_BKGS_ITEM_TYPE_CODE_FLAG
   ,BNDL_OFFSET.DV_BKGS_INTL_DEMO_FLAG
   ,BNDL_OFFSET.DV_BKGS_REPL_DEMO_FLAG
   ,BNDL_OFFSET.DV_BKGS_REVENUE_FLAG
   ,BNDL_OFFSET.DV_BKGS_OVERLAY_FLAG
   ,BNDL_OFFSET.DV_BKGS_SALESREP_FLAG
   ,BNDL_OFFSET.DV_BKGS_IC_REVENUE_FLAG
   ,BNDL_OFFSET.DV_BKGS_CHARGES_FLAG
   ,BNDL_OFFSET.DV_BKGS_MISC_FLAG
   ,BNDL_OFFSET.DV_BKGS_SERVICE_FLAG
   ,BNDL_OFFSET.DV_BKGS_CORP_BKG_FLAG
   ,BNDL_OFFSET.DV_BKGS_COMP_US_NET_PRC_AMT
   ,BNDL_OFFSET.DV_BKGS_COMP_US_LST_PRC_AMT
   ,BNDL_OFFSET.DV_BKGS_COMP_US_COST_AMT
   ,BNDL_OFFSET.DV_BKGS_EXTENDED_QUANTITY
   ,BNDL_OFFSET.BK_SCAA_SALES_REP_NUMBER
   ,BNDL_OFFSET.BK_SCAN_SALES_REP_NUMBER
   ,BNDL_OFFSET.SALES_COMMISSION_PERCENTAGE
   ,BNDL_OFFSET.SALES_CHANNEL_CODE
   ,BNDL_OFFSET.DV_COMP_US_STANDARD_PRICE_AMT
   ,BNDL_OFFSET.DV_FISCAL_YEAR_MTH_NUMBER_INT
   ,BNDL_OFFSET.REPORTED_SALES_ORDER_NUM_INT
   ,BNDL_OFFSET.PROCESS_DATE
   ,BNDL_OFFSET.AR_TRX_KEY
   ,BNDL_OFFSET.AR_TRX_LINE_KEY
   ,BNDL_OFFSET.PRODUCT_KEY
   ,BNDL_OFFSET.SALES_ORDER_KEY
   ,BNDL_OFFSET.SALES_ORDER_LINE_KEY
   ,BNDL_OFFSET.SHIP_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.SOLD_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.BILL_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.SALES_CREDIT_TYPE_CODE
   ,BNDL_OFFSET.EDW_CREATE_USER
   ,BNDL_OFFSET.EDW_UPDATE_USER
   ,BNDL_OFFSET.EDW_CREATE_DATETIME
   ,BNDL_OFFSET.EDW_UPDATE_DATETIME
   ,BNDL_OFFSET.CONVERSION_RT
   ,BNDL_OFFSET.DV_TRANSACTION_NAME
   ,BNDL_OFFSET.DEFAULT_SC_FLG
   ,BNDL_OFFSET.SK_LINE_SEQ_ID_INT
   ,BNDL_OFFSET.SCA_SOURCE_TYPE_CD
   ,BNDL_OFFSET.DV_TRANSACTION_SOURCE_CD
   ,BNDL_OFFSET.DV_TRANSACTION_KEY
   ,BNDL_OFFSET.DV_TRX_AMT                    
   ,BNDL_OFFSET.DV_FUNC_AMT                   
   ,BNDL_OFFSET.DV_TRX_QTY 
   ,BNDL_OFFSET.DV_REVENUE_RECOGNITION_FLG
   ,BNDL_OFFSET.DV_NET_SPREAD_FLG
   ,BNDL_OFFSET.DV_SALES_ORDER_LINE_KEY
   ,BNDL_OFFSET.SK_OFFER_ATTRIBUTION_ID_INT
   ,BNDL_OFFSET.DV_PRODUCT_KEY
   ,BNDL_OFFSET.DV_ATTRIBUTION_CD
   ,BNDL_OFFSET.ACTION_CODE
   ,BNDL_OFFSET.DML_TYPE
   ,BNDL_OFFSET.GLOBAL_NAME
 ,BNDL_OFFSET.POB_TYPE_CD
   ,BNDL_OFFSET.SALES_MOTION_CD /*Added as part of Oct-2017 release */
  FROM 
 (  
   SELECT
   1 AS DRVD_NCR_REV_TRX_BKG_KEY
   ,WDNRFB.TRANSACTION_SEQUENCE_ID_INT
   ,WDNRFB.SOURCE_SYSTEM_CODE
   ,WDNRFB.TRANSACTION_DATE
   ,WDNRFB.SK_PH_TRANSACTION_SEQ_ID_INT
   ,WDNRFB.PD_ACCOUNTING_RULE_NAME
   ,WDNRFB.ACCOUNT_CLASS_CODE
   ,WDNRFB.GL_DISTRIBUTION_FUNCTIONAL_AMT
   ,WDNRFB.ADJUSTMENT_TYPE_CODE
   ,WDNRFB.GL_DISTRIB_TRANSACTIONAL_AMT
   ,WDNRFB.CREATED_BY_INT
   ,WDNRFB.AR_TRX_LINE_TRANSACTIONAL_AMT
   ,WDNRFB.EXTRACT_TYPE_CODE
   ,WDNRFB.FORWARD_REVERSE_CODE
   ,WDNRFB.GL_DATETIME
   ,WDNRFB.GL_DATE
   ,WDNRFB.GL_POSTED_DATE
   ,WDNRFB.TRANSACTION_GROUPING_TYPE_CODE
   ,WDNRFB.LAST_UPDATED_BY_INT
   ,'N' AS LAST_RECORD_FLAG
   ,WDNRFB.LINE_TYPE_CODE
   ,WDNRFB.QUOTA_FLAG
   ,WDNRFB.REBATE_TRANSACTIONAL_AMOUNT
   ,WDNRFB.MANUAL_TRANSACTION_FLAG
   ,WDNRFB.RULE_START_DATETIME
   ,WDNRFB.TRANSACTION_DATETIME
   ,WDNRFB.TRANSACTION_QUANTITY
   ,WDNRFB.AR_TRX_DATETIME
   ,WDNRFB.AR_TRX_NUMBER
   ,WDNRFB.AR_TRX_TYPE_CODE
   ,WDNRFB.UNIT_SELLING_PRICE_TRX_AMT
   ,WDNRFB.UNIT_STANDARD_PRICE_TRX_AMT
   ,WDNRFB.PD_SALES_TERRITORY_KEY
   ,WDNRFB.PD_SALES_REP_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_COMPANY_CODE
   ,WDNRFB.PD_AR_ADJ_SET_OF_BOOKS_KEY
   ,WDNRFB.PD_FUNCTIONAL_CURRENCY_CODE
   ,WDNRFB.PD_INVOICE_CURRENCY_CODE
   ,WDNRFB.DV_FISCAL_CALENDAR_CODE
   ,WDNRFB.DV_FISCAL_MONTH_NUMBER_INT
   ,WDNRFB.DV_FISCAL_YEAR_NUMBER_INT
   ,WDNRFB.REPORTING_MEASURE_TYPE
   ,WDNRFB.BK_AR_TRX_LINE_GL_DISTRIB_KEY
   ,WDNRFB.REVENUE_TRANSFER_KEY
   ,WDNRFB.DV_FISCAL_DATE
   ,WDNRFB.DV_BKGS_ITEM_TYPE_CODE_FLAG
   ,WDNRFB.DV_BKGS_INTL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REPL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REVENUE_FLAG
   ,WDNRFB.DV_BKGS_OVERLAY_FLAG
   ,WDNRFB.DV_BKGS_SALESREP_FLAG
   ,WDNRFB.DV_BKGS_IC_REVENUE_FLAG
   ,CASE WHEN NP.BK_PRODUCT_TYPE_ID='CHARGES' THEN 'Y' ELSE 'N' END DV_BKGS_CHARGES_FLAG
   ,CASE WHEN SUBSTR(NP.BK_PRODUCT_ID,1,4)='MISC' THEN 'Y' ELSE 'N' END DV_BKGS_MISC_FLAG
   ,CASE WHEN NP.GOODS_OR_SERVICE_TYPE='SERVICE' THEN 'Y' ELSE 'N' END DV_BKGS_SERVICE_FLAG
   ,WDNRFB.DV_BKGS_CORP_BKG_FLAG
   ,WDNRFB.DV_BKGS_COMP_US_NET_PRC_AMT
   ,WDNRFB.DV_BKGS_COMP_US_LST_PRC_AMT
   ,WDNRFB.DV_BKGS_COMP_US_COST_AMT
   ,WDNRFB.DV_BKGS_EXTENDED_QUANTITY
   ,WDNRFB.BK_SCAA_SALES_REP_NUMBER
   ,WDNRFB.BK_SCAN_SALES_REP_NUMBER
   ,WDNRFB.SALES_COMMISSION_PERCENTAGE
   ,WDNRFB.SALES_CHANNEL_CODE
   ,WDNRFB.DV_COMP_US_STANDARD_PRICE_AMT
   ,WDNRFB.DV_FISCAL_YEAR_MTH_NUMBER_INT
   ,WDNRFB.REPORTED_SALES_ORDER_NUM_INT
   ,WDNRFB.PROCESS_DATE
   ,WDNRFB.AR_TRX_KEY
   ,WDNRFB.AR_TRX_LINE_KEY
   ,WDRTO.DV_PRODUCT_KEY AS PRODUCT_KEY      /*TOPSKU PRODUCT KEY*/  
   ,WDNRFB.SALES_ORDER_KEY
   ,-9999 AS SALES_ORDER_LINE_KEY
   ,WDNRFB.SHIP_TO_CUSTOMER_KEY
   ,WDNRFB.SOLD_TO_CUSTOMER_KEY
   ,WDNRFB.BILL_TO_CUSTOMER_KEY
   ,WDNRFB.SALES_CREDIT_TYPE_CODE
   ,WDNRFB.EDW_CREATE_USER
   ,WDNRFB.EDW_UPDATE_USER
   ,WDNRFB.EDW_CREATE_DATETIME
   ,WDNRFB.EDW_UPDATE_DATETIME
   ,WDNRFB.CONVERSION_RT
   ,WDNRFB.DV_TRANSACTION_NAME
   ,WDNRFB.DEFAULT_SC_FLG
   ,WDNRFB.SK_LINE_SEQ_ID_INT
   ,WDNRFB.SCA_SOURCE_TYPE_CD
   ,WDNRFB.DV_TRANSACTION_SOURCE_CD
   ,WDNRFB.DV_TRANSACTION_KEY
   ,WDNRFB.DV_TRX_AMT                    
   ,WDNRFB.DV_FUNC_AMT                   
   ,WDNRFB.DV_TRX_QTY 
   ,WDNRFB.DV_REVENUE_RECOGNITION_FLG
   ,WDNRFB.DV_NET_SPREAD_FLG
   ,WDRTO.DV_SALES_ORDER_LINE_KEY AS DV_SALES_ORDER_LINE_KEY
   ,WDRTO.SK_OFFER_ATTRIBUTION_ID_INT AS SK_OFFER_ATTRIBUTION_ID_INT
   ,WDRTO.DV_PRODUCT_KEY AS DV_PRODUCT_KEY
   ,'BUNDLE'  AS DV_ATTRIBUTION_CD
   ,WDNRFB.ACTION_CODE
   ,WDNRFB.DML_TYPE
   ,WDNRFB.GLOBAL_NAME
,WDRTO.POB_TYPE_CD
   ,WDNRFB.SALES_MOTION_CD /*Added as part of Oct-2017 release */
  FROM 
  $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT WDNRFB
  INNER JOIN $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_RT_OA WDRTO
  ON (WDNRFB.TRANSACTION_SEQUENCE_ID_INT=WDRTO.TRANSACTION_SEQUENCE_ID_INT AND WDNRFB.SOURCE_SYSTEM_CODE=WDRTO.SOURCE_SYSTEM_CODE)
  INNER JOIN $$COMREFVWDB.N_PRODUCT NP
 ON WDRTO.DV_PRODUCT_KEY = NP.ITEM_KEY
 WHERE 
 WDRTO.DV_ATTRIBUTION_CD = 'ATTRIBUTED'

UNION ALL
  
  SELECT
   1 AS DRVD_NCR_REV_TRX_BKG_KEY
   ,WDNRFB.TRANSACTION_SEQUENCE_ID_INT
   ,WDNRFB.SOURCE_SYSTEM_CODE
   ,WDNRFB.TRANSACTION_DATE
   ,WDNRFB.SK_PH_TRANSACTION_SEQ_ID_INT
   ,WDNRFB.PD_ACCOUNTING_RULE_NAME
   ,WDNRFB.ACCOUNT_CLASS_CODE
   ,-1 * WDNRFB.GL_DISTRIBUTION_FUNCTIONAL_AMT
   ,WDNRFB.ADJUSTMENT_TYPE_CODE
   ,-1 * WDNRFB.GL_DISTRIB_TRANSACTIONAL_AMT
   ,WDNRFB.CREATED_BY_INT
   ,-1 * WDNRFB.AR_TRX_LINE_TRANSACTIONAL_AMT
   ,WDNRFB.EXTRACT_TYPE_CODE
   ,WDNRFB.FORWARD_REVERSE_CODE
   ,WDNRFB.GL_DATETIME
   ,WDNRFB.GL_DATE
   ,WDNRFB.GL_POSTED_DATE
   ,WDNRFB.TRANSACTION_GROUPING_TYPE_CODE
   ,WDNRFB.LAST_UPDATED_BY_INT
   ,'N' AS LAST_RECORD_FLAG
   ,WDNRFB.LINE_TYPE_CODE
   ,WDNRFB.QUOTA_FLAG
   ,-1 * WDNRFB.REBATE_TRANSACTIONAL_AMOUNT
   ,WDNRFB.MANUAL_TRANSACTION_FLAG
   ,WDNRFB.RULE_START_DATETIME
   ,WDNRFB.TRANSACTION_DATETIME
   ,-1 * WDNRFB.TRANSACTION_QUANTITY
   ,WDNRFB.AR_TRX_DATETIME
   ,WDNRFB.AR_TRX_NUMBER
   ,WDNRFB.AR_TRX_TYPE_CODE
   ,-1 * WDNRFB.UNIT_SELLING_PRICE_TRX_AMT
   ,-1 * WDNRFB.UNIT_STANDARD_PRICE_TRX_AMT
   ,WDNRFB.PD_SALES_TERRITORY_KEY
   ,WDNRFB.PD_SALES_REP_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_COMPANY_CODE
   ,WDNRFB.PD_AR_ADJ_SET_OF_BOOKS_KEY
   ,WDNRFB.PD_FUNCTIONAL_CURRENCY_CODE
   ,WDNRFB.PD_INVOICE_CURRENCY_CODE
   ,WDNRFB.DV_FISCAL_CALENDAR_CODE
   ,WDNRFB.DV_FISCAL_MONTH_NUMBER_INT
   ,WDNRFB.DV_FISCAL_YEAR_NUMBER_INT
   ,WDNRFB.REPORTING_MEASURE_TYPE
   ,WDNRFB.BK_AR_TRX_LINE_GL_DISTRIB_KEY
   ,WDNRFB.REVENUE_TRANSFER_KEY
   ,WDNRFB.DV_FISCAL_DATE
   ,WDNRFB.DV_BKGS_ITEM_TYPE_CODE_FLAG
   ,WDNRFB.DV_BKGS_INTL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REPL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REVENUE_FLAG
   ,WDNRFB.DV_BKGS_OVERLAY_FLAG
   ,WDNRFB.DV_BKGS_SALESREP_FLAG
   ,WDNRFB.DV_BKGS_IC_REVENUE_FLAG
   ,CASE WHEN NP.BK_PRODUCT_TYPE_ID='CHARGES' THEN 'Y' ELSE 'N' END DV_BKGS_CHARGES_FLAG
   ,CASE WHEN SUBSTR(NP.BK_PRODUCT_ID,1,4)='MISC' THEN 'Y' ELSE 'N' END DV_BKGS_MISC_FLAG
   ,CASE WHEN NP.GOODS_OR_SERVICE_TYPE='SERVICE' THEN 'Y' ELSE 'N' END DV_BKGS_SERVICE_FLAG
   ,WDNRFB.DV_BKGS_CORP_BKG_FLAG
   ,-1 * WDNRFB.DV_BKGS_COMP_US_NET_PRC_AMT
   ,-1 * WDNRFB.DV_BKGS_COMP_US_LST_PRC_AMT
   ,-1 * WDNRFB.DV_BKGS_COMP_US_COST_AMT
   ,-1 * WDNRFB.DV_BKGS_EXTENDED_QUANTITY
   ,WDNRFB.BK_SCAA_SALES_REP_NUMBER
   ,WDNRFB.BK_SCAN_SALES_REP_NUMBER
   ,WDNRFB.SALES_COMMISSION_PERCENTAGE
   ,WDNRFB.SALES_CHANNEL_CODE
   ,-1 * WDNRFB.DV_COMP_US_STANDARD_PRICE_AMT
   ,WDNRFB.DV_FISCAL_YEAR_MTH_NUMBER_INT
   ,WDNRFB.REPORTED_SALES_ORDER_NUM_INT
   ,WDNRFB.PROCESS_DATE
   ,WDNRFB.AR_TRX_KEY
   ,WDNRFB.AR_TRX_LINE_KEY
   ,WDRTO.DV_PRODUCT_KEY AS PRODUCT_KEY      /*TOPSKU PRODUCT KEY*/ 
   ,WDNRFB.SALES_ORDER_KEY
   ,-9999 AS SALES_ORDER_LINE_KEY
   ,WDNRFB.SHIP_TO_CUSTOMER_KEY
   ,WDNRFB.SOLD_TO_CUSTOMER_KEY
   ,WDNRFB.BILL_TO_CUSTOMER_KEY
   ,WDNRFB.SALES_CREDIT_TYPE_CODE
   ,WDNRFB.EDW_CREATE_USER
   ,WDNRFB.EDW_UPDATE_USER
   ,WDNRFB.EDW_CREATE_DATETIME
   ,WDNRFB.EDW_UPDATE_DATETIME
   ,WDNRFB.CONVERSION_RT
   ,WDNRFB.DV_TRANSACTION_NAME
   ,WDNRFB.DEFAULT_SC_FLG
   ,WDNRFB.SK_LINE_SEQ_ID_INT
   ,WDNRFB.SCA_SOURCE_TYPE_CD
   ,WDNRFB.DV_TRANSACTION_SOURCE_CD
   ,WDNRFB.DV_TRANSACTION_KEY
   ,-1 * WDNRFB.DV_TRX_AMT                    
   ,-1 * WDNRFB.DV_FUNC_AMT                   
   ,-1 * WDNRFB.DV_TRX_QTY 
   ,WDNRFB.DV_REVENUE_RECOGNITION_FLG
   ,WDNRFB.DV_NET_SPREAD_FLG
   ,WDRTO.DV_SALES_ORDER_LINE_KEY AS DV_SALES_ORDER_LINE_KEY
   ,WDRTO.SK_OFFER_ATTRIBUTION_ID_INT AS SK_OFFER_ATTRIBUTION_ID_INT
   ,WDRTO.DV_PRODUCT_KEY AS DV_PRODUCT_KEY
   ,'OFFSET'  AS DV_ATTRIBUTION_CD
   ,WDNRFB.ACTION_CODE
   ,WDNRFB.DML_TYPE 
   ,WDNRFB.GLOBAL_NAME
,WDRTO.POB_TYPE_CD
   ,WDNRFB.SALES_MOTION_CD /*Added as part of Oct-2017 release */
  FROM 
  $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT WDNRFB
  INNER JOIN $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_RT_OA WDRTO
  ON (WDNRFB.TRANSACTION_SEQUENCE_ID_INT=WDRTO.TRANSACTION_SEQUENCE_ID_INT AND WDNRFB.SOURCE_SYSTEM_CODE=WDRTO.SOURCE_SYSTEM_CODE)
  INNER JOIN $$COMREFVWDB.N_PRODUCT NP
  ON WDRTO.DV_PRODUCT_KEY = NP.ITEM_KEY
 WHERE 
 WDRTO.DV_ATTRIBUTION_CD = 'ATTRIBUTED'
 
)BNDL_OFFSET
CROSS JOIN 
( SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0)  AS TRANSACTION_SEQUENCE_ID_INT    FROM  $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT ) SM_MAX


Post SQL : 



Target2 Name : WI_DRVD_NCR_REV_FOR_BKGB_RT1


Pre SQL : 
DELETE FROM $$STGDB.WI_DRVD_NCR_REV_FOR_BKGB_RT ALL


Post SQL : 
CALL COLLECT_STATS_WRAP('$$STGDB','WI_DRVD_NCR_REV_FOR_BKGB_RT','D');


Source3 Name : SQ_SM_DRVD_NCR_REV_TRX_FOR_BKG


Pre SQL : 



SQL Query : 
SELECT RANK() OVER(ORDER BY WDNRTFR.TRANSACTION_SEQUENCE_ID_INT, WDNRTFR.SOURCE_SYSTEM_CODE) + SMDNRTFRKEY.MAX_VAL AS DRVD_NCR_REV_TRX_BKG_KEY, 
WDNRTFR.SOURCE_SYSTEM_CODE,
WDNRTFR.TRANSACTION_SEQUENCE_ID_INT, 
 USER ,
 CURRENT_TIMESTAMP(0)              
 FROM (SELECT COALESCE(MAX(SMDNRTFR.DRVD_NCR_REV_TRX_BKG_KEY),0) MAX_VAL 
 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SMDNRTFR ) SMDNRTFRKEY,
 $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT  WDNRTFR 
 WHERE NOT EXISTS ( SELECT 1 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFR   
WHERE WDNRTFR.TRANSACTION_SEQUENCE_ID_INT  = SDNRTFR.TRANSACTION_SEQUENCE_ID_INT
AND WDNRTFR.SOURCE_SYSTEM_CODE=SDNRTFR.SOURCE_SYSTEM_CODE)


Post SQL : 



Target3 Name : SM_DRVD_NCR_REV_TRX_FOR_BKG1


Pre SQL : 



Post SQL : 



Source4 Name : SQ_SM_DRVD_NCR_REV_TRX_FOR_BKG_BNDL_OFFSET


Pre SQL : 



SQL Query : 
SELECT RANK() OVER(ORDER BY WDNRTFR.TRANSACTION_SEQUENCE_ID_INT, WDNRTFR.SOURCE_SYSTEM_CODE) + SMDNRTFRKEY.MAX_VAL AS DRVD_NCR_REV_TRX_BKG_KEY, 
WDNRTFR.SOURCE_SYSTEM_CODE,
WDNRTFR.TRANSACTION_SEQUENCE_ID_INT, 
 USER ,
 CURRENT_TIMESTAMP(0)              
 FROM (SELECT COALESCE(MAX(SMDNRTFR.DRVD_NCR_REV_TRX_BKG_KEY),0) MAX_VAL 
 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SMDNRTFR ) SMDNRTFRKEY,
 $$STGDB.WI_DRVD_NCR_REV_FOR_BKGB_RT  WDNRTFR 
 WHERE NOT EXISTS ( SELECT 1 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFR   
WHERE WDNRTFR.TRANSACTION_SEQUENCE_ID_INT  = SDNRTFR.TRANSACTION_SEQUENCE_ID_INT
AND WDNRTFR.SOURCE_SYSTEM_CODE=SDNRTFR.SOURCE_SYSTEM_CODE)


Post SQL : 



Target4 Name : SM_DRVD_NCR_REV_TRX_FOR_BKG2


Pre SQL : 



Post SQL : 



Source5 Name : SQ_W_DRVD_NCR_REV_TRX_FOR_BKG


Pre SQL : 



SQL Query : 
SELECT 
  SDNRTFB.DRVD_NCR_REV_TRX_BKG_KEY AS DRVD_NCR_REV_TRX_BKG_KEY
   ,WDNRFB.TRANSACTION_SEQUENCE_ID_INT
   ,WDNRFB.SOURCE_SYSTEM_CODE
   ,WDNRFB.TRANSACTION_DATE
   ,WDNRFB.SK_PH_TRANSACTION_SEQ_ID_INT
   ,WDNRFB.PD_ACCOUNTING_RULE_NAME
   ,WDNRFB.ACCOUNT_CLASS_CODE
   ,WDNRFB.GL_DISTRIBUTION_FUNCTIONAL_AMT
   ,WDNRFB.ADJUSTMENT_TYPE_CODE
   ,WDNRFB.GL_DISTRIB_TRANSACTIONAL_AMT
   ,WDNRFB.CREATED_BY_INT
   ,WDNRFB.AR_TRX_LINE_TRANSACTIONAL_AMT
   ,WDNRFB.EXTRACT_TYPE_CODE
   ,WDNRFB.FORWARD_REVERSE_CODE
   ,WDNRFB.GL_DATETIME
   ,WDNRFB.GL_DATE
   ,WDNRFB.GL_POSTED_DATE
   ,WDNRFB.TRANSACTION_GROUPING_TYPE_CODE
   ,WDNRFB.LAST_UPDATED_BY_INT
   ,WDNRFB.LAST_RECORD_FLAG
   ,WDNRFB.LINE_TYPE_CODE
   ,WDNRFB.QUOTA_FLAG
   ,WDNRFB.REBATE_TRANSACTIONAL_AMOUNT
   ,WDNRFB.MANUAL_TRANSACTION_FLAG
   ,WDNRFB.RULE_START_DATETIME
   ,WDNRFB.TRANSACTION_DATETIME
   ,WDNRFB.TRANSACTION_QUANTITY
   ,WDNRFB.AR_TRX_DATETIME
   ,WDNRFB.AR_TRX_NUMBER
   ,WDNRFB.AR_TRX_TYPE_CODE
   ,WDNRFB.UNIT_SELLING_PRICE_TRX_AMT
   ,WDNRFB.UNIT_STANDARD_PRICE_TRX_AMT
   ,WDNRFB.PD_SALES_TERRITORY_KEY
   ,WDNRFB.PD_SALES_REP_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_NUMBER
   ,WDNRFB.PD_AR_ADJUSTMENT_COMPANY_CODE
   ,WDNRFB.PD_AR_ADJ_SET_OF_BOOKS_KEY
   ,WDNRFB.PD_FUNCTIONAL_CURRENCY_CODE
   ,WDNRFB.PD_INVOICE_CURRENCY_CODE
   ,WDNRFB.DV_FISCAL_CALENDAR_CODE
   ,WDNRFB.DV_FISCAL_MONTH_NUMBER_INT
   ,WDNRFB.DV_FISCAL_YEAR_NUMBER_INT
   ,WDNRFB.REPORTING_MEASURE_TYPE
   ,WDNRFB.BK_AR_TRX_LINE_GL_DISTRIB_KEY
   ,WDNRFB.DV_FISCAL_DATE
   ,WDNRFB.DV_BKGS_ITEM_TYPE_CODE_FLAG
   ,WDNRFB.DV_BKGS_INTL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REPL_DEMO_FLAG
   ,WDNRFB.DV_BKGS_REVENUE_FLAG
   ,WDNRFB.DV_BKGS_OVERLAY_FLAG
   ,WDNRFB.DV_BKGS_SALESREP_FLAG
   ,WDNRFB.DV_BKGS_IC_REVENUE_FLAG
   ,WDNRFB.DV_BKGS_CHARGES_FLAG
   ,WDNRFB.DV_BKGS_MISC_FLAG
   ,WDNRFB.DV_BKGS_SERVICE_FLAG
   ,WDNRFB.DV_BKGS_CORP_BKG_FLAG
   ,WDNRFB.DV_BKGS_COMP_US_NET_PRC_AMT
   ,WDNRFB.DV_BKGS_COMP_US_LST_PRC_AMT
   ,WDNRFB.DV_BKGS_COMP_US_COST_AMT
   ,WDNRFB.DV_BKGS_EXTENDED_QUANTITY
   ,WDNRFB.BK_SCAA_SALES_REP_NUMBER
   ,WDNRFB.BK_SCAN_SALES_REP_NUMBER
   ,WDNRFB.SALES_COMMISSION_PERCENTAGE
   ,WDNRFB.SALES_CHANNEL_CODE
   ,WDNRFB.DV_COMP_US_STANDARD_PRICE_AMT
   ,WDNRFB.DV_FISCAL_YEAR_MTH_NUMBER_INT
   ,WDNRFB.REPORTED_SALES_ORDER_NUM_INT
   ,WDNRFB.PROCESS_DATE
   ,WDNRFB.AR_TRX_KEY
   ,WDNRFB.AR_TRX_LINE_KEY
   ,WDNRFB.PRODUCT_KEY

  
 ,/*CASE WHEN ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS')*/
     CASE WHEN (ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
	          OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			  OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			  )  /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/ /*Added As part of TNC Feb 2020 Release*/ 
     THEN NATIL.EXAAS_SUBSCR_SO_KEY 
       ELSE WDNRFB.SALES_ORDER_KEY END AS SALES_ORDER_KEY

    ,CASE WHEN WDRTOA.DV_ATTRIBUTION_CD='ATTRIBUTED' AND
   /*ABT.BK_BATCH_SOURCE_NAME NOT IN ('XAAS','ICMS-XAAS','PP-XAAS') */
      ( ABT.BK_BATCH_SOURCE_NAME NOT LIKE ALL ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
	    OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME NOT IN ('XAAS'))
		OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME NOT IN ('XAAS'))
		) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/  /*Added As part of TNC Feb 2020 Release*/ 
      THEN -9999 
          WHEN WDRTOA.DV_ATTRIBUTION_CD='ATTRIBUTED' AND
		  /*ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS') */
		  ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
		   OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
		   OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
		   ) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/  /*Added As part of TNC Feb 2020 Release*/ 
		  THEN -6666
          WHEN WDRTOA.DV_ATTRIBUTION_CD<>'ATTRIBUTED' AND 
		  /*ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS')*/ 
		  ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
		    OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/ /*Added As part of TNC Feb 2020 Release*/ 
		  THEN NATL.RU_EXAAS_SUBSCRIPTION_SOL_KEY
          ELSE WDNRFB.SALES_ORDER_LINE_KEY  END AS  SALES_ORDER_LINE_KEY
 ,WDNRFB.SHIP_TO_CUSTOMER_KEY
   ,WDNRFB.SOLD_TO_CUSTOMER_KEY
   ,WDNRFB.BILL_TO_CUSTOMER_KEY
   ,WDNRFB.SALES_CREDIT_TYPE_CODE
   ,WDNRFB.EDW_CREATE_USER
   ,WDNRFB.EDW_UPDATE_USER
   ,WDNRFB.EDW_CREATE_DATETIME
   ,WDNRFB.EDW_UPDATE_DATETIME
   ,WDNRFB.CONVERSION_RT
   ,WDNRFB.DV_TRANSACTION_NAME
   ,WDNRFB.DEFAULT_SC_FLG
   ,WDNRFB.SK_LINE_SEQ_ID_INT
   ,WDNRFB.SCA_SOURCE_TYPE_CD
   ,WDNRFB.DV_TRANSACTION_SOURCE_CD
   ,WDNRFB.DV_TRANSACTION_KEY
   ,WDNRFB.DV_TRX_AMT                    
   ,WDNRFB.DV_FUNC_AMT                   
   ,WDNRFB.DV_TRX_QTY 
   ,WDNRFB.DV_REVENUE_RECOGNITION_FLG
   ,WDNRFB.DV_NET_SPREAD_FLG
   ,WDNRFB.REVENUE_TRANSFER_KEY
   /*start:RTEQ1FY15 */

 ,/*CASE WHEN ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS')*/
    CASE WHEN ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE') 
	         OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			 OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			 ) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/  /*Added As part of TNC Feb 2020 Release*/ 
    THEN NATL.RU_EXAAS_SUBSCRIPTION_SOL_KEY
           ELSE WDRTOA.DV_SALES_ORDER_LINE_KEY END AS DV_SALES_ORDER_LINE_KEY
 ,WDRTOA.SK_OFFER_ATTRIBUTION_ID_INT AS SK_OFFER_ATTRIBUTION_ID_INT
   ,WDRTOA.DV_PRODUCT_KEY AS DV_PRODUCT_KEY
   ,WDRTOA.DV_ATTRIBUTION_CD  AS DV_ATTRIBUTION_CD
   /*RTEQ1FY15 :end*/
   ,WDNRFB.AR_TRX_LINE_KEY AS DV_AR_TRX_LINE_KEY /*sabanil : added as a part of OAQ1FY16 */
   ,-999 AS XAAS_OFFER_ATRBTN_REV_LINE_KEY /*sabanil : added as a part of OAQ1FY16 */
   ,CAST(0.0 AS DECIMAL(18,6)) DV_EXTND_LIST_PRICE_LOCAL_AMT
   ,CAST(0.0 AS DECIMAL(18,6)) UNIT_LIST_PRICE_LOCAL_AMT
   ,CAST(0.0 AS DECIMAL(18,6)) DV_UNIT_LIST_PRICE_USD_AMT
,WDRTOA.POB_TYPE_CD
   ,WDNRFB.SALES_MOTION_CD /* Added as part of Oct-2017 rel */
   ,WDNRFB.ACTION_CODE
   ,WDNRFB.DML_TYPE 
  FROM 
  $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_RT WDNRFB
  /*start:RTEQ1FY15 */
  INNER JOIN $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_RT_OA WDRTOA
  ON (WDNRFB.TRANSACTION_SEQUENCE_ID_INT=WDRTOA.TRANSACTION_SEQUENCE_ID_INT
		AND WDNRFB.SOURCE_SYSTEM_CODE=WDRTOA.SOURCE_SYSTEM_CODE) 
  /*RTEQ1FY15 :end*/
  INNER JOIN $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB
   ON ( SDNRTFB.TRANSACTION_SEQUENCE_ID_INT = WDNRFB.TRANSACTION_SEQUENCE_ID_INT AND WDNRFB.SOURCE_SYSTEM_CODE=SDNRTFB.SOURCE_SYSTEM_CODE)   
 /*PRMADDAL: Q3FY18 SO/SOL CHANGE */
   INNER JOIN $$FINLGLVWDB.N_AR_TRX NAT
   ON WDNRFB.AR_TRX_KEY = NAT.AR_TRX_KEY
   LEFT OUTER JOIN $$FINLGLVWDB.N_AR_BATCH_SOURCE ABT
   ON ABT.AR_BATCH_SOURCE_KEY = NAT.AR_BATCH_SOURCE_KEY 
   LEFT JOIN $$FINLGLVWDB.N_AR_TRX_ITEM_LINE NATIL
   ON WDNRFB.AR_TRX_LINE_KEY = NATIL.AR_TRX_LINE_KEY 
   LEFT  JOIN $$FINLGLVWDB.N_AR_TRX_LINE NATL
   ON WDNRFB.AR_TRX_LINE_KEY = NATL.AR_TRX_LINE_KEY

/* addded as a part RTEQ1FY15 to process the BUNDLED and OFFSET records */   
   UNION ALL
 SELECT
   SDNRTFB1.DRVD_NCR_REV_TRX_BKG_KEY AS DRVD_NCR_REV_TRX_BKG_KEY
   ,BNDL_OFFSET.TRANSACTION_SEQUENCE_ID_INT
   ,BNDL_OFFSET.SOURCE_SYSTEM_CODE
   ,BNDL_OFFSET.TRANSACTION_DATE
   ,BNDL_OFFSET.SK_PH_TRANSACTION_SEQ_ID_INT
   ,BNDL_OFFSET.PD_ACCOUNTING_RULE_NAME
   ,BNDL_OFFSET.ACCOUNT_CLASS_CODE
   ,BNDL_OFFSET.GL_DISTRIBUTION_FUNCTIONAL_AMT
   ,BNDL_OFFSET.ADJUSTMENT_TYPE_CODE
   ,BNDL_OFFSET.GL_DISTRIB_TRANSACTIONAL_AMT
   ,BNDL_OFFSET.CREATED_BY_INT
   ,BNDL_OFFSET.AR_TRX_LINE_TRANSACTIONAL_AMT
   ,BNDL_OFFSET.EXTRACT_TYPE_CODE
   ,BNDL_OFFSET.FORWARD_REVERSE_CODE
   ,BNDL_OFFSET.GL_DATETIME
   ,BNDL_OFFSET.GL_DATE
   ,BNDL_OFFSET.GL_POSTED_DATE
   ,BNDL_OFFSET.TRANSACTION_GROUPING_TYPE_CODE
   ,BNDL_OFFSET.LAST_UPDATED_BY_INT
   ,BNDL_OFFSET.LAST_RECORD_FLAG
   ,BNDL_OFFSET.LINE_TYPE_CODE
   ,BNDL_OFFSET.QUOTA_FLAG
   ,BNDL_OFFSET.REBATE_TRANSACTIONAL_AMOUNT
   ,BNDL_OFFSET.MANUAL_TRANSACTION_FLAG
   ,BNDL_OFFSET.RULE_START_DATETIME
   ,BNDL_OFFSET.TRANSACTION_DATETIME
   ,BNDL_OFFSET.TRANSACTION_QUANTITY
   ,BNDL_OFFSET.AR_TRX_DATETIME
   ,BNDL_OFFSET.AR_TRX_NUMBER
   ,BNDL_OFFSET.AR_TRX_TYPE_CODE
   ,BNDL_OFFSET.UNIT_SELLING_PRICE_TRX_AMT
   ,BNDL_OFFSET.UNIT_STANDARD_PRICE_TRX_AMT
   ,BNDL_OFFSET.PD_SALES_TERRITORY_KEY
   ,BNDL_OFFSET.PD_SALES_REP_NUMBER
   ,BNDL_OFFSET.PD_AR_ADJUSTMENT_NUMBER
   ,BNDL_OFFSET.PD_AR_ADJUSTMENT_COMPANY_CODE
   ,BNDL_OFFSET.PD_AR_ADJ_SET_OF_BOOKS_KEY
   ,BNDL_OFFSET.PD_FUNCTIONAL_CURRENCY_CODE
   ,BNDL_OFFSET.PD_INVOICE_CURRENCY_CODE
   ,BNDL_OFFSET.DV_FISCAL_CALENDAR_CODE
   ,BNDL_OFFSET.DV_FISCAL_MONTH_NUMBER_INT
   ,BNDL_OFFSET.DV_FISCAL_YEAR_NUMBER_INT
   ,BNDL_OFFSET.REPORTING_MEASURE_TYPE
   ,BNDL_OFFSET.BK_AR_TRX_LINE_GL_DISTRIB_KEY
   ,BNDL_OFFSET.DV_FISCAL_DATE
   ,BNDL_OFFSET.DV_BKGS_ITEM_TYPE_CODE_FLAG
   ,BNDL_OFFSET.DV_BKGS_INTL_DEMO_FLAG
   ,BNDL_OFFSET.DV_BKGS_REPL_DEMO_FLAG
   ,BNDL_OFFSET.DV_BKGS_REVENUE_FLAG
   ,BNDL_OFFSET.DV_BKGS_OVERLAY_FLAG
   ,BNDL_OFFSET.DV_BKGS_SALESREP_FLAG
   ,BNDL_OFFSET.DV_BKGS_IC_REVENUE_FLAG
   ,BNDL_OFFSET.DV_BKGS_CHARGES_FLAG
   ,BNDL_OFFSET.DV_BKGS_MISC_FLAG
   ,BNDL_OFFSET.DV_BKGS_SERVICE_FLAG
   ,BNDL_OFFSET.DV_BKGS_CORP_BKG_FLAG
   ,BNDL_OFFSET.DV_BKGS_COMP_US_NET_PRC_AMT
   ,BNDL_OFFSET.DV_BKGS_COMP_US_LST_PRC_AMT
   ,BNDL_OFFSET.DV_BKGS_COMP_US_COST_AMT
   ,BNDL_OFFSET.DV_BKGS_EXTENDED_QUANTITY
   ,BNDL_OFFSET.BK_SCAA_SALES_REP_NUMBER
   ,BNDL_OFFSET.BK_SCAN_SALES_REP_NUMBER
   ,BNDL_OFFSET.SALES_COMMISSION_PERCENTAGE
   ,BNDL_OFFSET.SALES_CHANNEL_CODE
   ,BNDL_OFFSET.DV_COMP_US_STANDARD_PRICE_AMT
   ,BNDL_OFFSET.DV_FISCAL_YEAR_MTH_NUMBER_INT
   ,BNDL_OFFSET.REPORTED_SALES_ORDER_NUM_INT
   ,BNDL_OFFSET.PROCESS_DATE
   ,BNDL_OFFSET.AR_TRX_KEY
   ,BNDL_OFFSET.AR_TRX_LINE_KEY
   ,BNDL_OFFSET.PRODUCT_KEY

 ,/*CASE WHEN ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS') */
   CASE WHEN ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
              OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			  OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			  ) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/ /*Added As part of TNC Feb 2020 Release*/ 
   THEN NATIL.EXAAS_SUBSCR_SO_KEY 
       ELSE BNDL_OFFSET.SALES_ORDER_KEY END AS SALES_ORDER_KEY 

 ,/*CASE WHEN ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS')*/
  CASE WHEN ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
              OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN('XAAS'))
			  OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN('XAAS'))
			  ) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/ /*Added As part of TNC Feb 2020 Release*/ 
  THEN -6666
          ELSE BNDL_OFFSET.SALES_ORDER_LINE_KEY END AS SALES_ORDER_LINE_KEY
   ,BNDL_OFFSET.SHIP_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.SOLD_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.BILL_TO_CUSTOMER_KEY
   ,BNDL_OFFSET.SALES_CREDIT_TYPE_CODE
   ,BNDL_OFFSET.EDW_CREATE_USER
   ,BNDL_OFFSET.EDW_UPDATE_USER
   ,BNDL_OFFSET.EDW_CREATE_DATETIME
   ,BNDL_OFFSET.EDW_UPDATE_DATETIME
   ,BNDL_OFFSET.CONVERSION_RT
   ,BNDL_OFFSET.DV_TRANSACTION_NAME
   ,BNDL_OFFSET.DEFAULT_SC_FLG
   ,BNDL_OFFSET.SK_LINE_SEQ_ID_INT
   ,BNDL_OFFSET.SCA_SOURCE_TYPE_CD
   ,BNDL_OFFSET.DV_TRANSACTION_SOURCE_CD
   ,BNDL_OFFSET.DV_TRANSACTION_KEY
   ,BNDL_OFFSET.DV_TRX_AMT                    
   ,BNDL_OFFSET.DV_FUNC_AMT                   
   ,BNDL_OFFSET.DV_TRX_QTY 
   ,BNDL_OFFSET.DV_REVENUE_RECOGNITION_FLG
   ,BNDL_OFFSET.DV_NET_SPREAD_FLG
   ,BNDL_OFFSET.REVENUE_TRANSFER_KEY
 
  ,/*CASE WHEN ABT.BK_BATCH_SOURCE_NAME IN ('XAAS','ICMS-XAAS','PP-XAAS')*/
    CASE WHEN ( ABT.BK_BATCH_SOURCE_NAME LIKE ANY ('XAAS%','ICMS-XAAS%','PP-XAAS%','CSP-MARKETPLACE')
	           OR ( ABT.BK_BATCH_SOURCE_NAME = 'ORDER MANAGEMENT'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			   OR ( ABT.BK_BATCH_SOURCE_NAME = 'ICMS-ADJ'  AND NATL.TRX_LINE_SRC_NAME IN ('XAAS'))
			   ) /*ADDED AS A PART OF Q1FY19 CE-BRAZIL*/ /*Added As part of TNC Feb 2020 Release*/ 
 THEN NATL.RU_EXAAS_SUBSCRIPTION_SOL_KEY
          ELSE BNDL_OFFSET.DV_SALES_ORDER_LINE_KEY END DV_SALES_ORDER_LINE_KEY
   ,BNDL_OFFSET.SK_OFFER_ATTRIBUTION_ID_INT
   ,BNDL_OFFSET.DV_PRODUCT_KEY
   ,BNDL_OFFSET.DV_ATTRIBUTION_CD
   ,BNDL_OFFSET.AR_TRX_LINE_KEY AS DV_AR_TRX_LINE_KEY /*sabanil : added as a part of OAQ1FY16 */
   ,-999 AS XAAS_OFFER_ATRBTN_REV_LINE_KEY /*sabanil : added as a part of OAQ1FY16 */
   ,CAST(0.0 AS DECIMAL(18,6)) DV_EXTND_LIST_PRICE_LOCAL_AMT
   ,CAST(0.0 AS DECIMAL(18,6)) UNIT_LIST_PRICE_LOCAL_AMT
   ,CAST(0.0 AS DECIMAL(18,6)) DV_UNIT_LIST_PRICE_USD_AMT
,BNDL_OFFSET.POB_TYPE_CD
   ,BNDL_OFFSET.SALES_MOTION_CD /* Added as part of Oct-2017 rel */
   ,BNDL_OFFSET.ACTION_CODE
   ,BNDL_OFFSET.DML_TYPE  
  FROM  
   $$STGDB.WI_DRVD_NCR_REV_FOR_BKGB_RT BNDL_OFFSET
    INNER JOIN $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB1
   ON ( SDNRTFB1.TRANSACTION_SEQUENCE_ID_INT = BNDL_OFFSET.TRANSACTION_SEQUENCE_ID_INT AND BNDL_OFFSET.SOURCE_SYSTEM_CODE=SDNRTFB1.SOURCE_SYSTEM_CODE)
 /*PRMADDAL: Q3FY18 SO/SOL CHANGE */
   INNER JOIN $$FINLGLVWDB.N_AR_TRX NAT
   ON BNDL_OFFSET.AR_TRX_KEY = NAT.AR_TRX_KEY
   LEFT OUTER JOIN $$FINLGLVWDB.N_AR_BATCH_SOURCE ABT
   ON ABT.AR_BATCH_SOURCE_KEY = NAT.AR_BATCH_SOURCE_KEY
   LEFT JOIN $$FINLGLVWDB.N_AR_TRX_ITEM_LINE NATIL
   ON BNDL_OFFSET.AR_TRX_LINE_KEY = NATIL.AR_TRX_LINE_KEY 
   LEFT JOIN $$FINLGLVWDB.N_AR_TRX_LINE NATL
   ON BNDL_OFFSET.AR_TRX_LINE_KEY = NATL.AR_TRX_LINE_KEY


Post SQL : 



Target5 Name : W_DRVD_NCR_REV_TRX_FOR_BKG1


Pre SQL : 
DELETE FROM $$WORKDB.W_DRVD_NCR_REV_TRX_FOR_BKG WHERE REVENUE_TRANSFER_KEY<>-999;


Post SQL : 



Source6 Name : SQ_WI_DRVD_NCR_REV_TRX_BKG_RTE_SMC_R


Pre SQL : 
DELETE FROM $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_SMC ;


SQL Query : 
SELECT -99999 AS DRVD_NCR_REV_TRX_BKG_KEY
,ROW_NUMBER() OVER( ORDER BY WI.SOURCE_COMMIT_TIME )  + SM_MAX.MAX_TRX_SEQ_ID AS TRANSACTION_SEQUENCE_ID_INT 
,DRVD.SOURCE_SYSTEM_CODE
,CAST(WI.SOURCE_COMMIT_TIME AS DATE) AS TRANSACTION_DATE
,ROW_NUMBER()   OVER( ORDER BY WI.SOURCE_COMMIT_TIME ) + SM_MAX.MAX_TRX_SEQ_ID AS SK_PH_TRANSACTION_SEQ_ID_INT
,DRVD.PD_ACCOUNTING_RULE_NAME
,DRVD.ACCOUNT_CLASS_CODE
,DRVD.GL_DISTRIBUTION_FUNCTIONAL_AMT
,DRVD.ADJUSTMENT_TYPE_CODE
,DRVD.GL_DISTRIB_TRANSACTIONAL_AMT
,DRVD.CREATED_BY_INT
,DRVD.AR_TRX_LINE_TRANSACTIONAL_AMT
,DRVD.EXTRACT_TYPE_CODE
,'R' AS FORWARD_REVERSE_CODE
,DRVD.GL_DATETIME
,DRVD.GL_DATE
,DRVD.GL_POSTED_DATE
,'I' AS TRANSACTION_GROUPING_TYPE_CODE
,DRVD.LAST_UPDATED_BY_INT
,'N' AS LAST_RECORD_FLAG
,DRVD.LINE_TYPE_CODE
,DRVD.QUOTA_FLAG
,DRVD.REBATE_TRANSACTIONAL_AMOUNT
,DRVD.MANUAL_TRANSACTION_FLAG
,DRVD.RULE_START_DATETIME
,WI.SOURCE_COMMIT_TIME AS TRANSACTION_DATETIME
,DRVD.TRANSACTION_QUANTITY
,DRVD.AR_TRX_DATETIME
,DRVD.AR_TRX_NUMBER
,DRVD.AR_TRX_TYPE_CODE
,DRVD.UNIT_SELLING_PRICE_TRX_AMT
,DRVD.UNIT_STANDARD_PRICE_TRX_AMT
,DRVD.PD_SALES_TERRITORY_KEY
,DRVD.PD_SALES_REP_NUMBER
,DRVD.PD_AR_ADJUSTMENT_NUMBER
,DRVD.PD_AR_ADJUSTMENT_COMPANY_CODE
,DRVD.PD_AR_ADJ_SET_OF_BOOKS_KEY
,DRVD.PD_FUNCTIONAL_CURRENCY_CODE
,DRVD.PD_INVOICE_CURRENCY_CODE
,DRVD.DV_FISCAL_CALENDAR_CODE
,NFISMN_SYS.BK_FISCAL_MONTH_NUMBER_INT AS DV_FISCAL_MONTH_NUMBER_INT 
,NFISMN_SYS.BK_FISCAL_YEAR_NUMBER_INT  AS DV_FISCAL_YEAR_NUMBER_INT  
,DRVD.REPORTING_MEASURE_TYPE
,DRVD.BK_AR_TRX_LINE_GL_DISTRIB_KEY
,CASE WHEN DRVD.SCA_SOURCE_TYPE_CD ='O' THEN CAST(DRVD.DV_FISCAL_DATE AS DATE) ELSE CAST(WI.SOURCE_COMMIT_TIME AS DATE) END AS DV_FISCAL_DATE 
,DRVD.DV_BKGS_ITEM_TYPE_CODE_FLAG
,DRVD.DV_BKGS_INTL_DEMO_FLAG
,DRVD.DV_BKGS_REPL_DEMO_FLAG
,DRVD.DV_BKGS_REVENUE_FLAG
,DRVD.DV_BKGS_OVERLAY_FLAG
,DRVD.DV_BKGS_SALESREP_FLAG
,DRVD.DV_BKGS_IC_REVENUE_FLAG
,DRVD.DV_BKGS_CHARGES_FLAG
,DRVD.DV_BKGS_MISC_FLAG
,DRVD.DV_BKGS_SERVICE_FLAG
,DRVD.DV_BKGS_CORP_BKG_FLAG
,DRVD.DV_BKGS_COMP_US_NET_PRC_AMT   * -1 AS DV_BKGS_COMP_US_NET_PRC_AMT
,DRVD.DV_BKGS_COMP_US_LST_PRC_AMT   * -1 AS DV_BKGS_COMP_US_LST_PRC_AMT
,DRVD.DV_BKGS_COMP_US_COST_AMT      * -1 AS DV_BKGS_COMP_US_COST_AMT
,DRVD.DV_BKGS_EXTENDED_QUANTITY
,DRVD.BK_SCAA_SALES_REP_NUMBER
,DRVD.BK_SCAN_SALES_REP_NUMBER
,DRVD.SALES_COMMISSION_PERCENTAGE   * -1 AS SALES_COMMISSION_PERCENTAGE
,DRVD.SALES_CHANNEL_CODE
,DRVD.DV_COMP_US_STANDARD_PRICE_AMT
,(NFISMN_SYS.BK_FISCAL_MONTH_NUMBER_INT+NFISMN_SYS.BK_FISCAL_YEAR_NUMBER_INT * 100 ) AS DV_FISCAL_YEAR_MTH_NUMBER_INT
,DRVD.REPORTED_SALES_ORDER_NUM_INT
,CAST(BPDC.PROCESS_DATE AS DATE) AS PROCESS_DATE 
,DRVD.AR_TRX_KEY
,DRVD.AR_TRX_LINE_KEY
,DRVD.PRODUCT_KEY
,DRVD.SALES_ORDER_KEY
,DRVD.SALES_ORDER_LINE_KEY
,DRVD.SHIP_TO_CUSTOMER_KEY
,DRVD.SOLD_TO_CUSTOMER_KEY
,DRVD.BILL_TO_CUSTOMER_KEY
,DRVD.SALES_CREDIT_TYPE_CODE
,USER AS  EDW_CREATE_USER 
,USER AS  EDW_UPDATE_USER   
,CURRENT_TIMESTAMP(0)
,CURRENT_TIMESTAMP(0) 
,DRVD.CONVERSION_RT
,DRVD.DV_TRANSACTION_NAME
,DRVD.DEFAULT_SC_FLG
,DRVD.SK_LINE_SEQ_ID_INT
,DRVD.SCA_SOURCE_TYPE_CD
,DRVD.DV_TRANSACTION_SOURCE_CD
,DRVD.DV_TRANSACTION_KEY
,DRVD.DV_TRX_AMT
,DRVD.DV_FUNC_AMT
,DRVD.DV_TRX_QTY
,DRVD.DV_REVENUE_RECOGNITION_FLG
,DRVD.DV_NET_SPREAD_FLG
,DRVD.REVENUE_TRANSFER_KEY
,DRVD.DV_SALES_ORDER_LINE_KEY
,DRVD.SK_OFFER_ATTRIBUTION_ID_INT
,DRVD.DV_PRODUCT_KEY
,DRVD.DV_ATTRIBUTION_CD
,DRVD.DV_AR_TRX_LINE_KEY
,DRVD.XAAS_OFFER_ATRBTN_REV_LINE_KEY
,DRVD.SK_SC_AGENT_ID_INT
,DRVD.DV_EXTND_LIST_PRICE_LOCAL_AMT
,DRVD.UNIT_LIST_PRICE_LOCAL_AMT
,DRVD.DV_UNIT_LIST_PRICE_USD_AMT
,DRVD.SALES_MOTION_CD
,DRVD.DV_COMP_US_NET_PURC_ADJ_AMT
,DRVD.POB_TYPE_CD
,DRVD.RETAINED_EARNINGS_FLG
,DRVD.NRS_TRANSITION_FLG
,DRVD.TRANSACTION_SEQUENCE_ID_INT AS OLD_TRANSACTION_SEQ_ID
FROM $$FINLGLVWDB.N_DRVD_NCR_REV_TRX_FOR_BKG DRVD 
INNER JOIN 
    ( SELECT SALES_ORDER_LINE_KEY, SALES_MOTION_CD, SOURCE_COMMIT_TIME
       FROM $$STGDB.WI_AR_SALES_MOTION_CHANGE    
	   WHERE EDW_UPDATE_DTM > ( SELECT LAST_EXTRACT_DATE FROM $$ETLVWDB.CTL_ETL_LAST_EXTRACT_DATES 
								WHERE JOB_STREAM_ID = 'wf_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT'  
								  AND TABLE_NAME = 'WI_AR_SALES_MOTION_CHANGE'  
						       )
     ) WI  							   
   ON DRVD.DV_SALES_ORDER_LINE_KEY = WI.SALES_ORDER_LINE_KEY 
  AND DRVD.SOURCE_SYSTEM_CODE = 'CG'
  AND DRVD.LAST_RECORD_FLAG = 'Y' 
  AND DRVD.REVENUE_TRANSFER_KEY > 0 
INNER JOIN ( SELECT PROCESS_DATE FROM $$ETLVWDB.BKG_PROCESS_DT_CNTRL ) BPDC
   ON 1 = 1
INNER JOIN  
( SELECT BK_FISCAL_MONTH_NUMBER_INT, BK_FISCAL_YEAR_NUMBER_INT
   FROM $$COMREFVWDB.N_FISCAL_MONTH 
  WHERE CURRENT_DATE-1 BETWEEN FISCAL_MONTH_START_DATE AND FISCAL_MONTH_END_DATE 
) NFISMN_SYS  
   ON 1=1
 INNER JOIN 
  ( SELECT MAX(MAX_TRX_SEQ_ID) AS MAX_TRX_SEQ_ID 
      FROM 
      (
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) MAX_TRX_SEQ_ID  FROM $$STGDB.WI_DRVD_NET_CHANGE_FOR_BKG WI_DRVD
		  union all   
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0)    AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_CG
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0)    AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REV_CG
		  UNION ALL
		SELECT COALESCE(MAX(BK_TRANSACTION_SEQ_ID_INT ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_REV
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RA_P
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RT_P
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RAE_P    
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_BKG_CG 
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_P  
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REVENUE_TRX_RV_P
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RT_CG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RAE_CG  
		UNION ALL 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RA_CG  
		union all 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REVENUE_TRX_P
		union all
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REVENUE_TRX_P
		union all 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_OM
		/* RCHETTRI : 11/18/2013 : ADDED TABLES */
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID        ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REVENUE_TRX_BKG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT    ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_CG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_TRX_XAAS /*thvarghe :Q3FY16 XAAS-SC Solution*/
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NET_CHANGE_FOR_BKG_XAAS DRVD_XAAS /*prmaddal :Q1FY18 XAAS-SC Implementation*/
		UNION ALL   /* Added as part of Accruals Q2FY19 */ 
		SELECT MAX(BK_TRANSACTION_SEQ_ID_INT) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NET_CHG_REV_ACRL_XAAS 
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REV_ACRL_TRX_CG
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_ACRL_TRX_CG
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_ACRL_TRX_CG
		UNION ALL   /* Added as part of Meraki Q2FY19 */ 
SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REV_MERK_TRX_CG
UNION ALL
SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_MERK_TRX_CG
UNION ALL
SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_MERK_TRX_CG
UNION ALL
SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REV_MERK_CG /*CARBT*/
UNION ALL
SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_MERK_CG /*CARBT*/
UNION ALL SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_SWSS_CG /*SWSS CHANGES*/
UNION ALL SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_TRX_SWSS_CG /*SWSS CHANGES*/ 
/* As part of Net Accounting*/
 UNION ALL
 SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM   $$STGDB.WI_OM_XXNCR_REVENUE_TRX_NA_P
 UNION ALL
 SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM   $$EXCEPDB.EX_OM_XXNCR_REV_NA_CG
/* As part of Net Accounting*/

      ) TMP
  ) SM_MAX
 ON 1=1
  WHERE NOT EXISTS 
 ( 
	 SELECT 1 FROM 
	 (
		 SEL BK_TRANSACTION_SEQ_ID_INT, BK_SS_CD FROM $$STGDB.WI_BKG_TX_SQ_ID_RTE
		  UNION  
		 SEL BK_TRANSACTION_SEQ_ID_INT, BK_SS_CD FROM $$STGDB.WI_BKG_TX_SQ_ID_FORWARD
	 ) WI  
    WHERE WI.BK_TRANSACTION_SEQ_ID_INT = DRVD.TRANSACTION_SEQUENCE_ID_INT
      AND WI.BK_SS_CD = DRVD.SOURCE_SYSTEM_CODE
 )


Post SQL : 



Target6 Name : WI_DRVD_NCR_REV_TRX_BKG_RTE_SMC_R


Pre SQL : 



Post SQL : 
INSERT INTO $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG
SELECT RANK() OVER(
ORDER BY WIOXRT.SOURCE_SYSTEM_CODE, WIOXRT.TRANSACTION_SEQUENCE_ID_INT) + SMATKEY.MAX_VAL DRVD_NCR_REV_TRX_BKG_KEY,
WIOXRT.SOURCE_SYSTEM_CODE,
WIOXRT.TRANSACTION_SEQUENCE_ID_INT ,
USER,
CURRENT_TIMESTAMP(0) 
FROM 
(SELECT COALESCE(MAX(SDNRTFB.DRVD_NCR_REV_TRX_BKG_KEY),0) MAX_VAL  
 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB ) SMATKEY,
(SELECT TRANSACTION_SEQUENCE_ID_INT,SOURCE_SYSTEM_CODE FROM $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_SMC) WIOXRT
WHERE 
NOT EXISTS ( 
SELECT 1 
FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB
WHERE WIOXRT.SOURCE_SYSTEM_CODE = SDNRTFB.SOURCE_SYSTEM_CODE
AND WIOXRT.TRANSACTION_SEQUENCE_ID_INT = SDNRTFB.TRANSACTION_SEQUENCE_ID_INT) ;


Source7 Name : SQ_WI_DRVD_NCR_REV_TRX_BKG_RTE_SMC_F


Pre SQL : 



SQL Query : 
SELECT 
-99999 AS DRVD_NCR_REV_TRX_BKG_KEY
,ROW_NUMBER() OVER( ORDER BY WI.SOURCE_COMMIT_TIME )  + SM_MAX.MAX_TRX_SEQ_ID AS TRANSACTION_SEQUENCE_ID_INT 
,DRVD.SOURCE_SYSTEM_CODE
,CAST(WI.SOURCE_COMMIT_TIME AS DATE) AS TRANSACTION_DATE
,ROW_NUMBER()   OVER( ORDER BY WI.SOURCE_COMMIT_TIME ) + SM_MAX.MAX_TRX_SEQ_ID AS SK_PH_TRANSACTION_SEQ_ID_INT
,DRVD.PD_ACCOUNTING_RULE_NAME
,DRVD.ACCOUNT_CLASS_CODE
,DRVD.GL_DISTRIBUTION_FUNCTIONAL_AMT
,DRVD.ADJUSTMENT_TYPE_CODE
,DRVD.GL_DISTRIB_TRANSACTIONAL_AMT
,DRVD.CREATED_BY_INT
,DRVD.AR_TRX_LINE_TRANSACTIONAL_AMT
,DRVD.EXTRACT_TYPE_CODE
,'F' AS FORWARD_REVERSE_CODE
,DRVD.GL_DATETIME
,DRVD.GL_DATE
,DRVD.GL_POSTED_DATE
,'I' AS TRANSACTION_GROUPING_TYPE_CODE
,DRVD.LAST_UPDATED_BY_INT
,'Y' AS LAST_RECORD_FLAG
,DRVD.LINE_TYPE_CODE
,DRVD.QUOTA_FLAG
,DRVD.REBATE_TRANSACTIONAL_AMOUNT
,DRVD.MANUAL_TRANSACTION_FLAG
,DRVD.RULE_START_DATETIME
,WI.SOURCE_COMMIT_TIME AS TRANSACTION_DATETIME
,DRVD.TRANSACTION_QUANTITY
,DRVD.AR_TRX_DATETIME
,DRVD.AR_TRX_NUMBER
,DRVD.AR_TRX_TYPE_CODE
,DRVD.UNIT_SELLING_PRICE_TRX_AMT
,DRVD.UNIT_STANDARD_PRICE_TRX_AMT
,DRVD.PD_SALES_TERRITORY_KEY
,DRVD.PD_SALES_REP_NUMBER
,DRVD.PD_AR_ADJUSTMENT_NUMBER
,DRVD.PD_AR_ADJUSTMENT_COMPANY_CODE
,DRVD.PD_AR_ADJ_SET_OF_BOOKS_KEY
,DRVD.PD_FUNCTIONAL_CURRENCY_CODE
,DRVD.PD_INVOICE_CURRENCY_CODE
,DRVD.DV_FISCAL_CALENDAR_CODE
,NFISMN_SYS.BK_FISCAL_MONTH_NUMBER_INT AS DV_FISCAL_MONTH_NUMBER_INT 
,NFISMN_SYS.BK_FISCAL_YEAR_NUMBER_INT  AS DV_FISCAL_YEAR_NUMBER_INT  
,DRVD.REPORTING_MEASURE_TYPE
,DRVD.BK_AR_TRX_LINE_GL_DISTRIB_KEY
,CASE WHEN DRVD.SCA_SOURCE_TYPE_CD ='O' THEN CAST(DRVD.DV_FISCAL_DATE AS DATE) ELSE CAST(WI.SOURCE_COMMIT_TIME AS DATE) END AS DV_FISCAL_DATE 
,DRVD.DV_BKGS_ITEM_TYPE_CODE_FLAG
,DRVD.DV_BKGS_INTL_DEMO_FLAG
,DRVD.DV_BKGS_REPL_DEMO_FLAG
,DRVD.DV_BKGS_REVENUE_FLAG
,DRVD.DV_BKGS_OVERLAY_FLAG
,DRVD.DV_BKGS_SALESREP_FLAG
,DRVD.DV_BKGS_IC_REVENUE_FLAG
,DRVD.DV_BKGS_CHARGES_FLAG
,DRVD.DV_BKGS_MISC_FLAG
,DRVD.DV_BKGS_SERVICE_FLAG
,DRVD.DV_BKGS_CORP_BKG_FLAG
,DRVD.DV_BKGS_COMP_US_NET_PRC_AMT    
,DRVD.DV_BKGS_COMP_US_LST_PRC_AMT    
,DRVD.DV_BKGS_COMP_US_COST_AMT       
,DRVD.DV_BKGS_EXTENDED_QUANTITY
,DRVD.BK_SCAA_SALES_REP_NUMBER
,DRVD.BK_SCAN_SALES_REP_NUMBER
,DRVD.SALES_COMMISSION_PERCENTAGE    
,DRVD.SALES_CHANNEL_CODE
,DRVD.DV_COMP_US_STANDARD_PRICE_AMT
,(NFISMN_SYS.BK_FISCAL_MONTH_NUMBER_INT+NFISMN_SYS.BK_FISCAL_YEAR_NUMBER_INT * 100 ) AS DV_FISCAL_YEAR_MTH_NUMBER_INT
,DRVD.REPORTED_SALES_ORDER_NUM_INT
,CAST(BPDC.PROCESS_DATE AS DATE) AS PROCESS_DATE 
,DRVD.AR_TRX_KEY
,DRVD.AR_TRX_LINE_KEY
,DRVD.PRODUCT_KEY
,DRVD.SALES_ORDER_KEY
,DRVD.SALES_ORDER_LINE_KEY
,DRVD.SHIP_TO_CUSTOMER_KEY
,DRVD.SOLD_TO_CUSTOMER_KEY
,DRVD.BILL_TO_CUSTOMER_KEY
,DRVD.SALES_CREDIT_TYPE_CODE
,USER AS  EDW_CREATE_USER 
,USER AS  EDW_UPDATE_USER   
,CURRENT_TIMESTAMP(0)
,CURRENT_TIMESTAMP(0) 
,DRVD.CONVERSION_RT
,DRVD.DV_TRANSACTION_NAME
,DRVD.DEFAULT_SC_FLG
,DRVD.SK_LINE_SEQ_ID_INT
,DRVD.SCA_SOURCE_TYPE_CD
,DRVD.DV_TRANSACTION_SOURCE_CD
,DRVD.DV_TRANSACTION_KEY
,DRVD.DV_TRX_AMT
,DRVD.DV_FUNC_AMT
,DRVD.DV_TRX_QTY
,DRVD.DV_REVENUE_RECOGNITION_FLG
,DRVD.DV_NET_SPREAD_FLG
,DRVD.REVENUE_TRANSFER_KEY
,DRVD.DV_SALES_ORDER_LINE_KEY
,DRVD.SK_OFFER_ATTRIBUTION_ID_INT
,DRVD.DV_PRODUCT_KEY
,DRVD.DV_ATTRIBUTION_CD
,DRVD.DV_AR_TRX_LINE_KEY
,DRVD.XAAS_OFFER_ATRBTN_REV_LINE_KEY
,DRVD.SK_SC_AGENT_ID_INT
,DRVD.DV_EXTND_LIST_PRICE_LOCAL_AMT
,DRVD.UNIT_LIST_PRICE_LOCAL_AMT
,DRVD.DV_UNIT_LIST_PRICE_USD_AMT
,WI.SALES_MOTION_CD
,DRVD.DV_COMP_US_NET_PURC_ADJ_AMT
,DRVD.POB_TYPE_CD
,DRVD.RETAINED_EARNINGS_FLG
,DRVD.NRS_TRANSITION_FLG
,DRVD.TRANSACTION_SEQUENCE_ID_INT AS OLD_TRANSACTION_SEQ_ID
FROM $$FINLGLVWDB.N_DRVD_NCR_REV_TRX_FOR_BKG DRVD 
INNER JOIN 
    ( SELECT SALES_ORDER_LINE_KEY, SALES_MOTION_CD, SOURCE_COMMIT_TIME
       FROM $$STGDB.WI_AR_SALES_MOTION_CHANGE    
	   WHERE EDW_UPDATE_DTM > ( SELECT LAST_EXTRACT_DATE FROM $$ETLVWDB.CTL_ETL_LAST_EXTRACT_DATES 
								WHERE JOB_STREAM_ID = 'wf_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT'  
								  AND TABLE_NAME = 'WI_AR_SALES_MOTION_CHANGE'  
						       )
     ) WI  							   
   ON DRVD.DV_SALES_ORDER_LINE_KEY = WI.SALES_ORDER_LINE_KEY 
  AND DRVD.SOURCE_SYSTEM_CODE = 'CG'
  AND DRVD.LAST_RECORD_FLAG = 'Y' 
  AND DRVD.REVENUE_TRANSFER_KEY > 0 
INNER JOIN ( SELECT PROCESS_DATE FROM $$ETLVWDB.BKG_PROCESS_DT_CNTRL ) BPDC
   ON 1 = 1
INNER JOIN  
( SELECT BK_FISCAL_MONTH_NUMBER_INT, BK_FISCAL_YEAR_NUMBER_INT
   FROM $$COMREFVWDB.N_FISCAL_MONTH 
  WHERE CURRENT_DATE-1 BETWEEN FISCAL_MONTH_START_DATE AND FISCAL_MONTH_END_DATE 
) NFISMN_SYS  
   ON 1=1
 INNER JOIN 
  ( SELECT MAX(MAX_TRX_SEQ_ID) AS MAX_TRX_SEQ_ID 
      FROM 
      (
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) MAX_TRX_SEQ_ID  FROM $$STGDB.WI_DRVD_NET_CHANGE_FOR_BKG WI_DRVD
		  union all   
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0)    AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_CG
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0)    AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REV_CG
		  UNION ALL
		SELECT COALESCE(MAX(BK_TRANSACTION_SEQ_ID_INT ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_REV
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RA_P
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RT_P
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_RAE_P    
		  UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_BKG_CG 
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REVENUE_TRX_P  
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REVENUE_TRX_RV_P
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RT_CG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RAE_CG  
		UNION ALL 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_RA_CG  
		union all 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REVENUE_TRX_P
		union all
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID   ),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REVENUE_TRX_P
		union all 
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_OM
		/* RCHETTRI : 11/18/2013 : ADDED TABLES */
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID        ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REVENUE_TRX_BKG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT    ),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM $$STGDB.WI_DRVD_NCR_REV_FOR_BKG_CG
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_TRX_XAAS /*thvarghe :Q3FY16 XAAS-SC Solution*/
		UNION ALL
		SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID_INT),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NET_CHANGE_FOR_BKG_XAAS DRVD_XAAS /*prmaddal :Q1FY18 XAAS-SC Implementation*/
		UNION ALL   /* Added as part of Accruals Q2FY19 */ 
		SELECT MAX(BK_TRANSACTION_SEQ_ID_INT) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NET_CHG_REV_ACRL_XAAS 
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REV_ACRL_TRX_CG
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_ACRL_TRX_CG
		UNION ALL
		SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_ACRL_TRX_CG
		UNION ALL   /* Added as part of Meraki Q2FY19 */ 
        SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_OM_XXNCR_REV_MERK_TRX_CG
        UNION ALL
        SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_MERK_TRX_CG
        UNION ALL
        SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_MERK_TRX_CG
		UNION ALL
SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_WI_OM_XXNCR_REV_MERK_CG /*CARBT*/
UNION ALL
SELECT MAX(TRANSACTION_SEQUENCE_ID   ) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_MERK_CG /*CARBT*/
UNION ALL SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$EXCEPDB.EX_OM_XXNCR_REV_SWSS_CG /*SWSS CHANGES*/
UNION ALL SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT FROM $$STGDB.WI_DRVD_NCR_REV_TRX_SWSS_CG /*SWSS CHANGES*/ 
/* As part of Net Accounting*/
 UNION ALL
 SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM   $$STGDB.WI_OM_XXNCR_REVENUE_TRX_NA_P
 UNION ALL
 SELECT COALESCE(MAX(TRANSACTION_SEQUENCE_ID),0) AS TRANSACTION_SEQUENCE_ID_INT    FROM   $$EXCEPDB.EX_OM_XXNCR_REV_NA_CG
/* As part of Net Accounting*/
      ) TMP
  ) SM_MAX
 ON 1=1
 WHERE NOT EXISTS 
 ( 
	 SELECT 1 FROM 
	 (
		 SEL BK_TRANSACTION_SEQ_ID_INT, BK_SS_CD FROM $$STGDB.WI_BKG_TX_SQ_ID_RTE
		  UNION  
		 SEL BK_TRANSACTION_SEQ_ID_INT, BK_SS_CD FROM $$STGDB.WI_BKG_TX_SQ_ID_FORWARD
	 ) WI  
    WHERE WI.BK_TRANSACTION_SEQ_ID_INT = DRVD.TRANSACTION_SEQUENCE_ID_INT
      AND WI.BK_SS_CD = DRVD.SOURCE_SYSTEM_CODE
 )


Post SQL : 



Target7 Name : WI_DRVD_NCR_REV_TRX_BKG_RTE_SMC_F


Pre SQL : 



Post SQL : 
CALL COLLECT_STATS_WRAP('$$STGDB','WI_DRVD_NCR_REV_TRX_BKG_SMC','D');

INSERT INTO $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG
SELECT RANK() OVER(
ORDER BY WIOXRT.SOURCE_SYSTEM_CODE, WIOXRT.TRANSACTION_SEQUENCE_ID_INT) + SMATKEY.MAX_VAL DRVD_NCR_REV_TRX_BKG_KEY,
WIOXRT.SOURCE_SYSTEM_CODE,
WIOXRT.TRANSACTION_SEQUENCE_ID_INT ,
USER,
CURRENT_TIMESTAMP(0) 
FROM 
(SELECT COALESCE(MAX(SDNRTFB.DRVD_NCR_REV_TRX_BKG_KEY),0) MAX_VAL  
 FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB ) SMATKEY,
(SELECT TRANSACTION_SEQUENCE_ID_INT,SOURCE_SYSTEM_CODE FROM $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_SMC) WIOXRT
WHERE 
NOT EXISTS ( 
SELECT 1 
FROM $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SDNRTFB
WHERE WIOXRT.SOURCE_SYSTEM_CODE = SDNRTFB.SOURCE_SYSTEM_CODE
AND WIOXRT.TRANSACTION_SEQUENCE_ID_INT = SDNRTFB.TRANSACTION_SEQUENCE_ID_INT) ;


Source8 Name : SQ_WI_DRVD_NCR_REV_TRX_BKG_SMC


Pre SQL : 



SQL Query : 
SELECT 
	 SM.DRVD_NCR_REV_TRX_BKG_KEY
	,WI.TRANSACTION_SEQUENCE_ID_INT   
	,WI.SOURCE_SYSTEM_CODE            
	,WI.TRANSACTION_DATE              
	,WI.SK_PH_TRANSACTION_SEQ_ID_INT  
	,WI.PD_ACCOUNTING_RULE_NAME       
	,WI.ACCOUNT_CLASS_CODE            
	,WI.GL_DISTRIBUTION_FUNCTIONAL_AMT
	,WI.ADJUSTMENT_TYPE_CODE          
	,WI.GL_DISTRIB_TRANSACTIONAL_AMT  
	,WI.CREATED_BY_INT                
	,WI.AR_TRX_LINE_TRANSACTIONAL_AMT 
	,WI.EXTRACT_TYPE_CODE             
	,WI.FORWARD_REVERSE_CODE          
	,WI.GL_DATETIME                   
	,WI.GL_DATE                       
	,WI.GL_POSTED_DATE                
	,WI.TRANSACTION_GROUPING_TYPE_CODE
	,WI.LAST_UPDATED_BY_INT           
	,WI.LAST_RECORD_FLAG              
	,WI.LINE_TYPE_CODE                
	,WI.QUOTA_FLAG                    
	,WI.REBATE_TRANSACTIONAL_AMOUNT   
	,WI.MANUAL_TRANSACTION_FLAG       
	,WI.RULE_START_DATETIME           
	,WI.TRANSACTION_DATETIME          
	,WI.TRANSACTION_QUANTITY          
	,WI.AR_TRX_DATETIME               
	,WI.AR_TRX_NUMBER                 
	,WI.AR_TRX_TYPE_CODE              
	,WI.UNIT_SELLING_PRICE_TRX_AMT    
	,WI.UNIT_STANDARD_PRICE_TRX_AMT   
	,WI.PD_SALES_TERRITORY_KEY        
	,WI.PD_SALES_REP_NUMBER           
	,WI.PD_AR_ADJUSTMENT_NUMBER       
	,WI.PD_AR_ADJUSTMENT_COMPANY_CODE 
	,WI.PD_AR_ADJ_SET_OF_BOOKS_KEY    
	,WI.PD_FUNCTIONAL_CURRENCY_CODE   
	,WI.PD_INVOICE_CURRENCY_CODE      
	,WI.DV_FISCAL_CALENDAR_CODE       
	,WI.DV_FISCAL_MONTH_NUMBER_INT    
	,WI.DV_FISCAL_YEAR_NUMBER_INT     
	,WI.REPORTING_MEASURE_TYPE        
	,WI.BK_AR_TRX_LINE_GL_DISTRIB_KEY 
	,WI.DV_FISCAL_DATE                
	,WI.DV_BKGS_ITEM_TYPE_CODE_FLAG   
	,WI.DV_BKGS_INTL_DEMO_FLAG        
	,WI.DV_BKGS_REPL_DEMO_FLAG        
	,WI.DV_BKGS_REVENUE_FLAG          
	,WI.DV_BKGS_OVERLAY_FLAG          
	,WI.DV_BKGS_SALESREP_FLAG         
	,WI.DV_BKGS_IC_REVENUE_FLAG       
	,WI.DV_BKGS_CHARGES_FLAG          
	,WI.DV_BKGS_MISC_FLAG             
	,WI.DV_BKGS_SERVICE_FLAG          
	,WI.DV_BKGS_CORP_BKG_FLAG         
	,WI.DV_BKGS_COMP_US_NET_PRC_AMT   
	,WI.DV_BKGS_COMP_US_LST_PRC_AMT   
	,WI.DV_BKGS_COMP_US_COST_AMT      
	,WI.DV_BKGS_EXTENDED_QUANTITY     
	,WI.BK_SCAA_SALES_REP_NUMBER      
	,WI.BK_SCAN_SALES_REP_NUMBER      
	,WI.SALES_COMMISSION_PERCENTAGE   
	,WI.SALES_CHANNEL_CODE            
	,WI.DV_COMP_US_STANDARD_PRICE_AMT 
	,WI.DV_FISCAL_YEAR_MTH_NUMBER_INT 
	,WI.REPORTED_SALES_ORDER_NUM_INT  
	,WI.PROCESS_DATE                  
	,WI.AR_TRX_KEY                    
	,WI.AR_TRX_LINE_KEY               
	,WI.PRODUCT_KEY                   
	,WI.SALES_ORDER_KEY               
	,WI.SALES_ORDER_LINE_KEY          
	,WI.SHIP_TO_CUSTOMER_KEY          
	,WI.SOLD_TO_CUSTOMER_KEY          
	,WI.BILL_TO_CUSTOMER_KEY          
	,WI.SALES_CREDIT_TYPE_CODE        
	,WI.EDW_CREATE_USER               
	,WI.EDW_UPDATE_USER               
	,WI.EDW_CREATE_DATETIME           
	,WI.EDW_UPDATE_DATETIME           
	,WI.CONVERSION_RT                 
	,WI.DV_TRANSACTION_NAME           
	,WI.DEFAULT_SC_FLG                
	,WI.SK_LINE_SEQ_ID_INT            
	,WI.SCA_SOURCE_TYPE_CD            
	,WI.DV_TRANSACTION_SOURCE_CD      
	,WI.DV_TRANSACTION_KEY            
	,WI.DV_TRX_AMT                    
	,WI.DV_FUNC_AMT                   
	,WI.DV_TRX_QTY                    
	,WI.DV_REVENUE_RECOGNITION_FLG    
	,WI.DV_NET_SPREAD_FLG             
	,WI.REVENUE_TRANSFER_KEY          
	,WI.DV_SALES_ORDER_LINE_KEY       
	,WI.SK_OFFER_ATTRIBUTION_ID_INT   
	,WI.DV_PRODUCT_KEY                
	,WI.DV_ATTRIBUTION_CD             
	,WI.DV_AR_TRX_LINE_KEY            
	,WI.XAAS_OFFER_ATRBTN_REV_LINE_KEY
	,WI.SK_SC_AGENT_ID_INT            
	,WI.DV_EXTND_LIST_PRICE_LOCAL_AMT 
	,WI.UNIT_LIST_PRICE_LOCAL_AMT     
	,WI.DV_UNIT_LIST_PRICE_USD_AMT    
	,WI.SALES_MOTION_CD               
	,WI.DV_COMP_US_NET_PURC_ADJ_AMT 
FROM $$STGDB.WI_DRVD_NCR_REV_TRX_BKG_SMC WI ,
     $$ETLVWDB.SM_DRVD_NCR_REV_TRX_FOR_BKG SM
WHERE WI.TRANSACTION_SEQUENCE_ID_INT = SM.TRANSACTION_SEQUENCE_ID_INT     
  AND WI.SOURCE_SYSTEM_CODE = SM.SOURCE_SYSTEM_CODE


Post SQL : 



Target8 Name : W_DRVD_NCR_REV_TRX_FOR_BKG_RTE_SMC


Pre SQL : 



Post SQL : 
CALL COLLECT_STATS_WRAP('$$WORKDB','W_DRVD_NCR_REV_TRX_FOR_BKG','D');

UPDATE EL 
FROM $$ETLVWDB.CTL_ETL_LAST_EXTRACT_DATES EL, 
	 ( SELECT MAX(EDW_UPDATE_DTM) MAX_UPD_DATE FROM $$STGDB.WI_AR_SALES_MOTION_CHANGE ) WI 
 SET LAST_EXTRACT_DATE = COALESCE(WI.MAX_UPD_DATE , EL.LAST_EXTRACT_DATE ) 
WHERE JOB_STREAM_ID = 'wf_WK_DRVD_NCR_REV_TRX_FOR_BKG_RT'  
AND TABLE_NAME = 'WI_AR_SALES_MOTION_CHANGE' ;