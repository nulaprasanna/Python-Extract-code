ETL Name:	wf_MT_RSTD_BKGS_MSR_ANNUITY_SRVC_HIST_prod.xml


Session 1: 	s_m_MT_RSTD_BKGS_MSR_ANNUITY_SRVC_HIST
Mapping 1: 	m_MT_RSTD_BKGS_MSR_ANNUITY_SRVC_HISTm_MT_RSTD_BKGS_MSR_ANNUITY_SRVC_HIST


Source1 Name : SQ_1_WI_MT_RSTD_BKGS_MEASURE


Pre SQL : 



SQL Query : 
SELECT 
BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
BOOKINGS_PROCESS_DATE               ,
SALES_TERRITORY_KEY,
SALES_REP_NUMBER,
RU_SERVICE_CONTRACT_START_DTM            ,
RU_SERVICE_CONTRACT_END_DTM                ,
DV_CONTRACT_DURATION                ,
DV_ANNUALIZED_FLG                         ,
DV_ANNUALIZED_US_NET_AMT            ,
DV_MULTIYEAR_US_NET_AMT            ,
CASE WHEN DV_CONTRACT_DURATION <> 0 THEN DD_COMP_US_NET_PRICE_AMOUNT/DV_CONTRACT_DURATION ELSE 0 END AS PER_MONTH_AMT,
CAST( DV_CONTRACT_DURATION/12  AS INTEGER ) CONTRACT_TERM,
RSTART.FISCAL_YEAR_MONTH_INT CONTRACT_START_MONTH,
RBKGS.FISCAL_YEAR_MONTH_INT BOOKINGS_PROCESS_MONTH,
CASE WHEN  DV_ANNUALIZED_FLG='N'  
THEN 
  CASE WHEN MT.BKGS_MEASURE_TRANS_TYPE_CODE <> 'POS' OR (MT.BKGS_MEASURE_TRANS_TYPE_CODE = 'POS' AND  DV_CONTRACT_DURATION IS NOT NULL)
  THEN
  CASE WHEN  DV_CONTRACT_DURATION IS NOT NULL  AND MT.RU_SERVICE_CONTRACT_START_DTM IS NOT NULL AND MT.RU_SERVICE_CONTRACT_END_DTM IS NOT NULL                                
  THEN                                                                                     
  CASE WHEN RSTART.FISCAL_YEAR_MONTH_INT IS NOT NULL 
  THEN                                                                                                                     
  CASE
  WHEN ((CAST((CAST(MT.RU_SERVICE_CONTRACT_END_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER)) 
  <=0 ) AND  (CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE)-CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER)) < 0  
  THEN 'ANNUITY1' 
  WHEN ((CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE)-CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER))  BETWEEN 1 AND 335)  
  THEN 'ANNUITY2'
  WHEN (CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE)) AS INTEGER))>335  
  THEN 'ANNUITY2' 
  WHEN  ((CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS 
  INTEGER)) BETWEEN -364 AND -1) AND (CAST((CAST(MT.RU_SERVICE_CONTRACT_END_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER)) >0  
  THEN 'ANNUITY2'
  WHEN  ((CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS 
  INTEGER)) <= -365 ) AND (CAST((CAST(MT.RU_SERVICE_CONTRACT_END_DTM AS DATE) -CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER)) >0  
  THEN 'ANNUITY3'
  WHEN (CAST((CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE)-CAST(MT.BOOKINGS_PROCESS_DATE AS DATE))  AS INTEGER)) = 0  
  THEN 'ANNUITY2'
  ELSE 'NA'
  END                                                                                                                       
  ELSE 'NA'
  END                                                                                                       
WHEN  DV_CONTRACT_DURATION IS NOT NULL  AND (MT.RU_SERVICE_CONTRACT_START_DTM IS  NULL OR MT.RU_SERVICE_CONTRACT_END_DTM IS  NULL)
THEN  'ANNUITY6'                                                                           
ELSE 'NA' 
END       
WHEN MT.BKGS_MEASURE_TRANS_TYPE_CODE = 'POS' AND  DV_CONTRACT_DURATION IS NULL
 THEN 'ANNUITY5'                                                  /*   for  DISTI POS ratio Transaction having only duration  no start date and end date */
                                ELSE 'NA'
                                END                                                                                      
ELSE NULL           	

END ANNUITY_TYPE                                   
FROM $$SLSORDVWDB.MT_RSTD_BKGS_MEASURE  MT
LEFT OUTER  JOIN $$COMREFVWDB.R_FISCAL_DAY_TO_YEAR RSTART /*Performance Recommendation*/
ON  CAST(MT.RU_SERVICE_CONTRACT_START_DTM AS DATE) =RSTART.CALENDAR_DATE
INNER JOIN $$COMREFVWDB.R_FISCAL_DAY_TO_YEAR RBKGS
ON MT.BOOKINGS_PROCESS_DATE=RBKGS.CALENDAR_DATE
WHERE  SERVICE_FLG='Y' 
AND (MT.DV_FISCAL_YEAR_MTH_NUMBER_INT,MT.BKGS_MEASURE_TRANS_TYPE_CODE) IN (SELECT FISCAL_YEAR_MONTH_INT,BKGS_MEASURE_TRANS_TYPE_CODE FROM $$STGDB.WI_ANNUITY_MONTH_CTRL_HIST)
/* Added as part of Q3FY18 goponnus */
AND MT.BKGS_MEASURE_TRANS_TYPE_CODE NOT IN ('XAAS')
/* END Q3FY18 */


Post SQL : 



Target1 Name : WI_MT_RSTD_BKGS_MEASURE_1


Pre SQL : 
DELETE FROM $$STGDB.WI_MT_RSTD_BKGS_MEASURE;


Post SQL : 
COLLECT STATS $$STGDB.WI_MT_RSTD_BKGS_MEASURE;


Source2 Name : SQ_2_WI_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY,
MT.SALES_REP_NUMBER,
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
RFISCAL.FISCAL_YEAR_MONTH_INT    ANNUITY_MONTH,      
MT.DV_MULTIYEAR_US_NET_AMT      AS         ANNUITY_AMT
FROM 
$$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
INNER JOIN  $$COMREFVWDB.R_FISCAL_MONTH_TO_YEAR RFISCAL
ON MT.BOOKINGS_PROCESS_DATE BETWEEN RFISCAL.FISCAL_MONTH_START_DATE AND RFISCAL.FISCAL_MONTH_END_DATE
WHERE ANNUITY_TYPE='ANNUITY1'  AND DV_ANNUALIZED_FLG='N'


Post SQL : 



Target2 Name : WI_MT_RSTD_BKGS_MSR_ANNUITY_2


Pre SQL : 
DELETE FROM $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Post SQL : 
COLLECT STATS $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Source3 Name : SQ_3_WI_RSTD_BKGS_MSR_ANNUITY_23


Pre SQL : 



SQL Query : 
SELECT WI_RSTD_BKGS_MSR_ANNUITY_23.BOOKINGS_MEASURE_KEY, WI_RSTD_BKGS_MSR_ANNUITY_23.BKGS_MEASURE_TRANS_TYPE_CODE, WI_RSTD_BKGS_MSR_ANNUITY_23.BOOKINGS_PROCESS_DATE, WI_RSTD_BKGS_MSR_ANNUITY_23.SALES_TERRITORY_KEY, WI_RSTD_BKGS_MSR_ANNUITY_23.SALES_REP_NUMBER, WI_RSTD_BKGS_MSR_ANNUITY_23.RU_SERVICE_CONTRACT_START_DTM, WI_RSTD_BKGS_MSR_ANNUITY_23.RU_SERVICE_CONTRACT_END_DTM, WI_RSTD_BKGS_MSR_ANNUITY_23.DV_CONTRACT_DURATION, WI_RSTD_BKGS_MSR_ANNUITY_23.DV_ANNUALIZED_FLG, WI_RSTD_BKGS_MSR_ANNUITY_23.DV_ANNUALIZED_US_NET_AMT, WI_RSTD_BKGS_MSR_ANNUITY_23.DV_MULTIYEAR_US_NET_AMT, WI_RSTD_BKGS_MSR_ANNUITY_23.PER_MONTH_AMT, WI_RSTD_BKGS_MSR_ANNUITY_23.CONTRACT_TERM, WI_RSTD_BKGS_MSR_ANNUITY_23.CONTRACT_START_MONTH, WI_RSTD_BKGS_MSR_ANNUITY_23.BOOKINGS_PROCESS_MONTH, WI_RSTD_BKGS_MSR_ANNUITY_23.ANNUITY_TYPE, WI_RSTD_BKGS_MSR_ANNUITY_23.ANNUITY_NUMBER, WI_RSTD_BKGS_MSR_ANNUITY_23.ANNUITY_MONTH 
FROM
 $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23
WHERE 1=2


Post SQL : 



Target3 Name : WI_RSTD_BKGS_MSR_ANNUITY_3


Pre SQL : 
DELETE FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23 ;


Post SQL : 
INSERT INTO $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23(
	BOOKINGS_MEASURE_KEY          
,	BKGS_MEASURE_TRANS_TYPE_CODE  
,	BOOKINGS_PROCESS_DATE         
,	SALES_TERRITORY_KEY           
,	SALES_REP_NUMBER              
,	RU_SERVICE_CONTRACT_START_DTM 
,	RU_SERVICE_CONTRACT_END_DTM   
,	DV_CONTRACT_DURATION          
,	DV_ANNUALIZED_FLG             
,	DV_ANNUALIZED_US_NET_AMT      
,	DV_MULTIYEAR_US_NET_AMT       
,	PER_MONTH_AMT                 
,	CONTRACT_TERM               
,	CONTRACT_START_MONTH          
,	BOOKINGS_PROCESS_MONTH        
,	ANNUITY_TYPE   
,   ANNUITY_NUMBER               
,	ANNUITY_MONTH                 

)
  WITH RECURSIVE ALL_TRIPS
(
	BOOKINGS_MEASURE_KEY          
,	BKGS_MEASURE_TRANS_TYPE_CODE  
,	BOOKINGS_PROCESS_DATE         
,	SALES_TERRITORY_KEY           
,	SALES_REP_NUMBER              
,	RU_SERVICE_CONTRACT_START_DTM 
,	RU_SERVICE_CONTRACT_END_DTM   
,	DV_CONTRACT_DURATION          
,	DV_ANNUALIZED_FLG             
,	DV_ANNUALIZED_US_NET_AMT      
,	DV_MULTIYEAR_US_NET_AMT       
,	PER_MONTH_AMT                 
,	CONTRACT_TERM               
,	CONTRACT_START_MONTH          
,	BOOKINGS_PROCESS_MONTH        
,	ANNUITY_TYPE 
,   ANNUITY_NUMBER                 
,	ANNUITY_MONTH                 

) AS
(
SELECT
	MT.BOOKINGS_MEASURE_KEY          
,	MT.BKGS_MEASURE_TRANS_TYPE_CODE  
,	MT.BOOKINGS_PROCESS_DATE         
,	MT.SALES_TERRITORY_KEY           
,	MT.SALES_REP_NUMBER              
,	MT.RU_SERVICE_CONTRACT_START_DTM 
,	MT.RU_SERVICE_CONTRACT_END_DTM   
,	MT.DV_CONTRACT_DURATION          
,	MT.DV_ANNUALIZED_FLG             
,	MT.DV_ANNUALIZED_US_NET_AMT      
,	MT.DV_MULTIYEAR_US_NET_AMT       
,	MT.PER_MONTH_AMT                 
,	MT.CONTRACT_TERM               
,	MT.CONTRACT_START_MONTH  
,	MT.BOOKINGS_PROCESS_MONTH        
,	MT.ANNUITY_TYPE      
,   1  ANNUITY_NUMBER
,	MT.CONTRACT_START_MONTH        +100  ANNUITY_MONTH                   
FROM 
$$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
WHERE ANNUITY_TYPE IN ('ANNUITY2' ,'ANNUITY3')  AND MT.DV_ANNUALIZED_FLG='N' 

UNION ALL 

SELECT
	ALL_TRIPS.BOOKINGS_MEASURE_KEY          
,	ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE  
,	ALL_TRIPS.BOOKINGS_PROCESS_DATE         
,	ALL_TRIPS.SALES_TERRITORY_KEY           
,	ALL_TRIPS.SALES_REP_NUMBER              
,	ALL_TRIPS.RU_SERVICE_CONTRACT_START_DTM 
,	ALL_TRIPS.RU_SERVICE_CONTRACT_END_DTM   
,	ALL_TRIPS.DV_CONTRACT_DURATION          
,	ALL_TRIPS.DV_ANNUALIZED_FLG             
,	ALL_TRIPS.DV_ANNUALIZED_US_NET_AMT      
,	ALL_TRIPS.DV_MULTIYEAR_US_NET_AMT       
,	ALL_TRIPS.PER_MONTH_AMT                 
,	ALL_TRIPS.CONTRACT_TERM               
,	ALL_TRIPS.CONTRACT_START_MONTH          
,	ALL_TRIPS.BOOKINGS_PROCESS_MONTH        
,	ALL_TRIPS.ANNUITY_TYPE 
,   ALL_TRIPS.ANNUITY_NUMBER   +1        ANNUITY_NUMBER1      
,	ALL_TRIPS.ANNUITY_MONTH   +100  ANNUITY_MONTH1

FROM  ALL_TRIPS
INNER JOIN $$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY  =   MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE = MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE = MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY = MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER = MT.SALES_REP_NUMBER
WHERE ALL_TRIPS.ANNUITY_TYPE  IN ('ANNUITY2' ,'ANNUITY3')   AND ALL_TRIPS.DV_ANNUALIZED_FLG='N' AND ANNUITY_NUMBER1<=ALL_TRIPS.CONTRACT_TERM  
  )
SELECT * FROM ALL_TRIPS   ;

/*ANNUITY6*/

INSERT INTO $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23(
	BOOKINGS_MEASURE_KEY          
,	BKGS_MEASURE_TRANS_TYPE_CODE  
,	BOOKINGS_PROCESS_DATE         
,	SALES_TERRITORY_KEY           
,	SALES_REP_NUMBER              
,	RU_SERVICE_CONTRACT_START_DTM 
,	RU_SERVICE_CONTRACT_END_DTM   
,	DV_CONTRACT_DURATION          
,	DV_ANNUALIZED_FLG             
,	DV_ANNUALIZED_US_NET_AMT      
,	DV_MULTIYEAR_US_NET_AMT       
,	PER_MONTH_AMT                 
,	CONTRACT_TERM               
,	CONTRACT_START_MONTH          
,	BOOKINGS_PROCESS_MONTH        
,	ANNUITY_TYPE   
,   ANNUITY_NUMBER               
,	ANNUITY_MONTH                 
)
WITH RECURSIVE ALL_TRIPS
(
	BOOKINGS_MEASURE_KEY          
,	BKGS_MEASURE_TRANS_TYPE_CODE  
,	BOOKINGS_PROCESS_DATE         
,	SALES_TERRITORY_KEY           
,	SALES_REP_NUMBER              
,	RU_SERVICE_CONTRACT_START_DTM 
,	RU_SERVICE_CONTRACT_END_DTM   
,	DV_CONTRACT_DURATION          
,	DV_ANNUALIZED_FLG             
,	DV_ANNUALIZED_US_NET_AMT      
,	DV_MULTIYEAR_US_NET_AMT       
,	PER_MONTH_AMT                 
,	CONTRACT_TERM               
,	CONTRACT_START_MONTH          
,	BOOKINGS_PROCESS_MONTH        
,	ANNUITY_TYPE 
,   ANNUITY_NUMBER                 
,	ANNUITY_MONTH                 
) AS
(
SELECT
	MT.BOOKINGS_MEASURE_KEY          
,	MT.BKGS_MEASURE_TRANS_TYPE_CODE  
,	MT.BOOKINGS_PROCESS_DATE         
,	MT.SALES_TERRITORY_KEY           
,	MT.SALES_REP_NUMBER              
,	MT.RU_SERVICE_CONTRACT_START_DTM 
,	MT.RU_SERVICE_CONTRACT_END_DTM   
,	MT.DV_CONTRACT_DURATION          
,	MT.DV_ANNUALIZED_FLG             
,	MT.DV_ANNUALIZED_US_NET_AMT      
,	MT.DV_MULTIYEAR_US_NET_AMT       
,	MT.PER_MONTH_AMT                 
,	MT.CONTRACT_TERM               
,	MT.CONTRACT_START_MONTH  
,	MT.BOOKINGS_PROCESS_MONTH        
,	MT.ANNUITY_TYPE      
,   1  ANNUITY_NUMBER
,	MT.BOOKINGS_PROCESS_MONTH        +100  ANNUITY_MONTH                   
FROM 
$$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
WHERE ANNUITY_TYPE IN ('ANNUITY6' )  AND MT.DV_ANNUALIZED_FLG='N' 

UNION ALL 

SELECT
	ALL_TRIPS.BOOKINGS_MEASURE_KEY          
,	ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE  
,	ALL_TRIPS.BOOKINGS_PROCESS_DATE         
,	ALL_TRIPS.SALES_TERRITORY_KEY           
,	ALL_TRIPS.SALES_REP_NUMBER              
,	ALL_TRIPS.RU_SERVICE_CONTRACT_START_DTM 
,	ALL_TRIPS.RU_SERVICE_CONTRACT_END_DTM   
,	ALL_TRIPS.DV_CONTRACT_DURATION          
,	ALL_TRIPS.DV_ANNUALIZED_FLG             
,	ALL_TRIPS.DV_ANNUALIZED_US_NET_AMT      
,	ALL_TRIPS.DV_MULTIYEAR_US_NET_AMT       
,	ALL_TRIPS.PER_MONTH_AMT                 
,	ALL_TRIPS.CONTRACT_TERM               
,	ALL_TRIPS.CONTRACT_START_MONTH          
,	ALL_TRIPS.BOOKINGS_PROCESS_MONTH        
,	ALL_TRIPS.ANNUITY_TYPE 
,   ALL_TRIPS.ANNUITY_NUMBER   +1        ANNUITY_NUMBER1      
,	ALL_TRIPS.ANNUITY_MONTH   +100  ANNUITY_MONTH1

FROM  ALL_TRIPS
INNER JOIN $$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY  =   MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE = MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE = MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY = MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER = MT.SALES_REP_NUMBER
WHERE ALL_TRIPS.ANNUITY_TYPE  IN ('ANNUITY6')   AND ALL_TRIPS.DV_ANNUALIZED_FLG='N' AND ANNUITY_NUMBER1<=ALL_TRIPS.CONTRACT_TERM  
  )
SELECT * FROM ALL_TRIPS   ;

COLLECT STATS ON  $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23 ;


Source4 Name : SQ_4_WI_RSTD_BKGS_MSR_ANNUITY_3_KEY


Pre SQL : 



SQL Query : 
SELECT 
BOOKINGS_MEASURE_KEY        ,  
BKGS_MEASURE_TRANS_TYPE_CODE , 
BOOKINGS_PROCESS_DATE   ,      
SALES_TERRITORY_KEY   ,        
SALES_REP_NUMBER   , 
CASE WHEN  ((CAST(CAST(BOOKINGS_PROCESS_DATE AS DATE) -  CAST(RU_SERVICE_CONTRACT_START_DTM AS DATE) AS INTEGER)*12(FLOAT))/365 )  - ( DV_CONTRACT_DURATION -12) >=0  THEN 'ANNUITY31' 
 ELSE   CASE WHEN ANNUITY_MONTH1 <= BOOKINGS_PROCESS_MONTH   THEN  'ANNUITY321' ELSE 'ANNUITY322' END   END ANNUITY_TYPE
FROM
(
SELECT
BOOKINGS_MEASURE_KEY        ,  
BKGS_MEASURE_TRANS_TYPE_CODE , 
BOOKINGS_PROCESS_DATE   ,      
SALES_TERRITORY_KEY   ,        
SALES_REP_NUMBER   ,   
BOOKINGS_PROCESS_MONTH,  
RU_SERVICE_CONTRACT_START_DTM,
DV_CONTRACT_DURATION,           
MAX(ANNUITY_MONTH)  ANNUITY_MONTH1                 
FROM 
$$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23
WHERE ANNUITY_TYPE='ANNUITY3' 
GROUP BY 
BOOKINGS_MEASURE_KEY        ,  
BKGS_MEASURE_TRANS_TYPE_CODE , 
BOOKINGS_PROCESS_DATE   ,      
SALES_TERRITORY_KEY   ,        
SALES_REP_NUMBER   ,
BOOKINGS_PROCESS_MONTH,
RU_SERVICE_CONTRACT_START_DTM,
DV_CONTRACT_DURATION
) ABC


Post SQL : 



Target4 Name : WI_RSTD_BKGS_MSR_ANNUITY_3_KEY_4


Pre SQL : 
DELETE FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ;


Post SQL : 
COLLECT STATS $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY;


Source5 Name : SQ_5_WI_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   ,   
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.ANNUITY_MONTH  ,
MT.PER_MONTH_AMT  *12   ANNUITY_AMT
FROM 
$$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  MT
WHERE  ANNUITY_TYPE  in ( 'ANNUITY2' ,'ANNUITY6')  AND  (BOOKINGS_MEASURE_KEY,BKGS_MEASURE_TRANS_TYPE_CODE,BOOKINGS_PROCESS_DATE,ANNUITY_TYPE,SALES_TERRITORY_KEY,SALES_REP_NUMBER,ANNUITY_MONTH)  
NOT IN (
SELECT 
BOOKINGS_MEASURE_KEY  ,
BKGS_MEASURE_TRANS_TYPE_CODE  ,
BOOKINGS_PROCESS_DATE,
ANNUITY_TYPE,
SALES_TERRITORY_KEY,SALES_REP_NUMBER,
MAX(ANNUITY_MONTH)  ANNUITY_MONTH
FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  WHERE ANNUITY_TYPE  in ( 'ANNUITY2' ,'ANNUITY6')  
GROUP BY 
BOOKINGS_MEASURE_KEY  ,
BKGS_MEASURE_TRANS_TYPE_CODE  ,
BOOKINGS_PROCESS_DATE,SALES_TERRITORY_KEY,SALES_REP_NUMBER,
ANNUITY_TYPE ) 
UNION ALL
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   ,  
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.ANNUITY_MONTH  ,
MT.PER_MONTH_AMT  *    (MT.DV_CONTRACT_DURATION MOD 12 )   ANNUITY_AMT
FROM 
$$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  MT
WHERE   ANNUITY_TYPE  in ( 'ANNUITY2' ,'ANNUITY6')  AND (BOOKINGS_MEASURE_KEY,BKGS_MEASURE_TRANS_TYPE_CODE,BOOKINGS_PROCESS_DATE,ANNUITY_TYPE,SALES_TERRITORY_KEY,SALES_REP_NUMBER,ANNUITY_MONTH)
IN (
SELECT
BOOKINGS_MEASURE_KEY  ,
BKGS_MEASURE_TRANS_TYPE_CODE  ,
BOOKINGS_PROCESS_DATE,
ANNUITY_TYPE,
SALES_TERRITORY_KEY,SALES_REP_NUMBER,
MAX(ANNUITY_MONTH)  ANNUITY_MONTH
FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  WHERE ANNUITY_TYPE  in ( 'ANNUITY2' ,'ANNUITY6') 
GROUP BY 
BOOKINGS_MEASURE_KEY  ,
BKGS_MEASURE_TRANS_TYPE_CODE  ,
BOOKINGS_PROCESS_DATE,SALES_TERRITORY_KEY,SALES_REP_NUMBER,
ANNUITY_TYPE )
AND MT.DV_CONTRACT_DURATION MOD 12  <>0


Post SQL : 



Target5 Name : WI_MT_RSTD_BKGS_MSR_ANNUITY_5


Pre SQL : 



Post SQL : 
COLLECT STATS $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Source6 Name : SQ_6_WI_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   ,
MT.DV_CONTRACT_DURATION,   
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.ANNUITY_MONTH  ,
MT.PER_MONTH_AMT  *12   ANNUITY_AMT
FROM 
$$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  MT
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY     =         MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE     =        MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY    =    MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER     =        MT.SALES_REP_NUMBER  
WHERE  ALL_TRIPS.ANNUITY_TYPE='ANNUITY322' AND MT.ANNUITY_TYPE='ANNUITY3' 
AND ANNUITY_MONTH > MT.BOOKINGS_PROCESS_MONTH  
AND  (MT.BOOKINGS_MEASURE_KEY,MT.BKGS_MEASURE_TRANS_TYPE_CODE,MT.BOOKINGS_PROCESS_DATE,MT.SALES_TERRITORY_KEY,MT.SALES_REP_NUMBER,MT.ANNUITY_TYPE,MT.ANNUITY_MONTH)
NOT IN (
SELECT 
MT1.BOOKINGS_MEASURE_KEY,MT1.BKGS_MEASURE_TRANS_TYPE_CODE,MT1.BOOKINGS_PROCESS_DATE,MT1.SALES_TERRITORY_KEY,MT1.SALES_REP_NUMBER,MT1.ANNUITY_TYPE,
MAX(ANNUITY_MONTH)  ANNUITY_MONTH
FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23 MT1
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS1
ON ALL_TRIPS1.BOOKINGS_MEASURE_KEY     =         MT1.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS1.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT1.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS1.BOOKINGS_PROCESS_DATE     =        MT1.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS1.SALES_TERRITORY_KEY    =    MT1.SALES_TERRITORY_KEY   
AND ALL_TRIPS1.SALES_REP_NUMBER     =        MT1.SALES_REP_NUMBER  
 WHERE MT1.ANNUITY_TYPE='ANNUITY3' AND ALL_TRIPS1.ANNUITY_TYPE='ANNUITY322'   
 GROUP BY 
MT1.BOOKINGS_MEASURE_KEY,MT1.BKGS_MEASURE_TRANS_TYPE_CODE,MT1.BOOKINGS_PROCESS_DATE,MT1.SALES_TERRITORY_KEY,MT1.SALES_REP_NUMBER,MT1.ANNUITY_TYPE )

UNION ALL

SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   ,  
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.ANNUITY_MONTH  ,
MT.PER_MONTH_AMT  *    (MT.DV_CONTRACT_DURATION MOD 12 )     ANNUITY_AMT
FROM 
$$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23  MT
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY     =         MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE     =        MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY    =    MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER     =        MT.SALES_REP_NUMBER  
WHERE  ALL_TRIPS.ANNUITY_TYPE='ANNUITY322' AND MT.ANNUITY_TYPE='ANNUITY3' 
AND ANNUITY_MONTH > MT.BOOKINGS_PROCESS_MONTH 
 AND  (MT.BOOKINGS_MEASURE_KEY,MT.BKGS_MEASURE_TRANS_TYPE_CODE,MT.BOOKINGS_PROCESS_DATE,MT.SALES_TERRITORY_KEY,MT.SALES_REP_NUMBER,MT.ANNUITY_TYPE,MT.ANNUITY_MONTH)
IN (
SELECT 
MT1.BOOKINGS_MEASURE_KEY,MT1.BKGS_MEASURE_TRANS_TYPE_CODE,MT1.BOOKINGS_PROCESS_DATE,MT1.SALES_TERRITORY_KEY,MT1.SALES_REP_NUMBER,MT1.ANNUITY_TYPE,
MAX(ANNUITY_MONTH)  ANNUITY_MONTH
FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23 MT1
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS1
ON ALL_TRIPS1.BOOKINGS_MEASURE_KEY     =         MT1.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS1.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT1.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS1.BOOKINGS_PROCESS_DATE     =        MT1.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS1.SALES_TERRITORY_KEY    =    MT1.SALES_TERRITORY_KEY   
AND ALL_TRIPS1.SALES_REP_NUMBER     =        MT1.SALES_REP_NUMBER  
 WHERE MT1.ANNUITY_TYPE='ANNUITY3' AND ALL_TRIPS1.ANNUITY_TYPE='ANNUITY322'  
GROUP BY 
MT1.BOOKINGS_MEASURE_KEY,MT1.BKGS_MEASURE_TRANS_TYPE_CODE,MT1.BOOKINGS_PROCESS_DATE,MT1.SALES_TERRITORY_KEY,MT1.SALES_REP_NUMBER,MT1.ANNUITY_TYPE )
 AND  MT.DV_CONTRACT_DURATION MOD 12  <>0

UNION ALL

SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   , 
MT.DV_CONTRACT_DURATION, 
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.BOOKINGS_PROCESS_MONTH  ANNUITY_MONTH  ,
MT.PER_MONTH_AMT  * (MT.ANNUITY_NUMBER-1 ) *12  ANNUITY_AMT
FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_23   MT
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY     =         MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE     =        MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY    =    MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER     =        MT.SALES_REP_NUMBER  
 WHERE MT.ANNUITY_TYPE='ANNUITY3' AND ALL_TRIPS.ANNUITY_TYPE='ANNUITY322' 
 AND ANNUITY_MONTH > MT.BOOKINGS_PROCESS_MONTH  
QUALIFY  ANNUITY_NUMBER=MIN(ANNUITY_NUMBER) OVER (PARTITION BY MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE  ,MT.SALES_TERRITORY_KEY,MT.SALES_REP_NUMBER,
MT.ANNUITY_TYPE)

UNION ALL

SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY   ,        
MT.SALES_REP_NUMBER   , 
MT.DV_CONTRACT_DURATION, 
MT.DV_ANNUALIZED_FLG ,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
MT.BOOKINGS_PROCESS_MONTH ANNUITY_MONTH  ,
MT.DV_MULTIYEAR_US_NET_AMT    ANNUITY_AMT
FROM $$STGDB.WI_MT_RSTD_BKGS_MEASURE   MT
INNER JOIN $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY_3_KEY ALL_TRIPS
ON ALL_TRIPS.BOOKINGS_MEASURE_KEY     =         MT.BOOKINGS_MEASURE_KEY  
AND ALL_TRIPS.BKGS_MEASURE_TRANS_TYPE_CODE    =    MT.BKGS_MEASURE_TRANS_TYPE_CODE   
AND ALL_TRIPS.BOOKINGS_PROCESS_DATE     =        MT.BOOKINGS_PROCESS_DATE 
AND ALL_TRIPS.SALES_TERRITORY_KEY    =    MT.SALES_TERRITORY_KEY   
AND ALL_TRIPS.SALES_REP_NUMBER     =        MT.SALES_REP_NUMBER  
WHERE MT.ANNUITY_TYPE='ANNUITY3' AND ALL_TRIPS.ANNUITY_TYPE in ('ANNUITY31', 'ANNUITY321')


Post SQL : 



Target6 Name : WI_MT_RSTD_BKGS_MSR_ANNUITY_6


Pre SQL : 



Post SQL : 
COLLECT STATS $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Source7 Name : SQ_7_WI_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY,
MT.SALES_REP_NUMBER,
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE,
RFISCALAGE.FISCAL_YEAR_MONTH_INT    ANNUITY_MONTH,      
MT.DV_MULTIYEAR_US_NET_AMT      AS         ANNUITY_AMT
FROM 
$$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
INNER JOIN $$COMREFVWDB.R_FISCAL_MONTH_TO_YEAR RFISCAL
ON MT.BOOKINGS_PROCESS_DATE BETWEEN RFISCAL.FISCAL_MONTH_START_DATE AND RFISCAL.FISCAL_MONTH_END_DATE
INNER JOIN $$COMREFVWDB.R_FISCAL_MONTH_TO_YEAR RFISCALAGE
ON RFISCALAGE.FISCAL_MONTH_AGE+12  = RFISCAL.FISCAL_MONTH_AGE
WHERE ANNUITY_TYPE='ANNUITY5'  AND DV_ANNUALIZED_FLG='N'


Post SQL : 



Target7 Name : WI_MT_RSTD_BKGS_MSR_ANNUITY_7


Pre SQL : 



Post SQL : 
COLLECT STATS ON $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Source8 Name : SQ_8_WI_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
MT.BOOKINGS_MEASURE_KEY                 ,
MT.BKGS_MEASURE_TRANS_TYPE_CODE             ,
MT.BOOKINGS_PROCESS_DATE               ,
MT.SALES_TERRITORY_KEY,MT.SALES_REP_NUMBER,
MT.DV_CONTRACT_DURATION,
MT.DV_ANNUALIZED_FLG,
MT.RU_SERVICE_CONTRACT_START_DTM,
MT.RU_SERVICE_CONTRACT_END_DTM,
MT.ANNUITY_TYPE ANNUITY_TYPE,
CASE WHEN MT.DV_ANNUALIZED_FLG<>'N'  THEN NULL ELSE MT.BOOKINGS_PROCESS_MONTH END  ANNUITY_MONTH,
CASE WHEN MT.DV_ANNUALIZED_FLG<>'N'  THEN NULL ELSE MT.DV_MULTIYEAR_US_NET_AMT END  ANNUITY_AMT
FROM 
$$STGDB.WI_MT_RSTD_BKGS_MEASURE MT
WHERE MT.DV_ANNUALIZED_FLG<>'N'  OR  ( DV_ANNUALIZED_FLG='N' AND ANNUITY_TYPE='NA')


Post SQL : 



Target8 Name : WI_MT_RSTD_BKGS_MSR_ANNUITY_8


Pre SQL : 



Post SQL : 
COLLECT STATS $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY;


Source9 Name : SQ_81_WI_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
  RDAYS.FISCAL_YEAR_MONTH_INT  DV_FISCAL_YEAR_MONTH_INT  ,           
  MT.BOOKINGS_MEASURE_KEY ,
  MT.BKGS_MEASURE_TRANS_TYPE_CODE ,
  MT.BOOKINGS_PROCESS_DATE ,
  MT.SALES_TERRITORY_KEY,
  MT.SALES_REP_NUMBER,
  BKGS.SALES_ORDER_LINE_KEY,
  BKGS.DV_SALES_ORDER_LINE_KEY,
  BKGS.PRODUCT_KEY,
  BKGS.ADJUSTMENT_TYPE_CODE,
  BKGS.IDE_ADJUSTMENT_CODE,
  BKGS.ADJUSTMENT_CODE,
  BKGS.BILL_TO_CUSTOMER_KEY,
  BKGS.DV_END_CUSTOMER_KEY END_CUSTOMER_KEY,
  BKGS.SOLD_TO_CUSTOMER_KEY,
  BKGS.SHIP_TO_CUSTOMER_KEY,
  BKGS.DV_ATTRIBUTION_CD,
  BKGS.DV_REVENUE_RECOGNITION_FLG,
  BKGS.CORPORATE_BOOKINGS_FLG,
  BKGS.SERVICE_FLG,
  MT.RU_SERVICE_CONTRACT_START_DTM,
  MT.RU_SERVICE_CONTRACT_END_DTM,
  MT.DV_CONTRACT_DURATION,
  MT.DV_ANNUALIZED_FLG,
  'ANNUITY' DV_SRVC_BOOKINGS_TYPE ,
  MT.ANNUITY_TYPE DV_ANNUITY_TYPE ,
  COALESCE (RF.FISCAL_MONTH_START_DATE        , CAST('1900-01-01' AS DATE)) DV_ANNUITY_DATE                ,       
  COALESCE ( MT.ANNUITY_MONTH,-9999 ) DV_FISCAL_YEAR_ANNUITY_MTH_INT,
  MT.ANNUITY_AMT DV_ANNUITY_AMT,
  BKGS.CANCEL_CODE,
  BKGS.XCAT_FLG,
  BKGS.BK_OFFER_TYPE_NAME,
  BKGS.RECURRING_OFFER_FLG,
  BKGS.ELA_FLG,
BKGS.DV_RECURRING_OFFER_CD,
BKGS.SALES_MOTION_CD,
BKGS.SUMMARY_QUOTE_FLG
  FROM     
  $$STGDB.WI_MT_RSTD_BKGS_MSR_ANNUITY MT
  INNER JOIN $$COMREFVWDB.R_FISCAL_DAY_TO_YEAR RDAYS
  ON MT.BOOKINGS_PROCESS_DATE=RDAYS.CALENDAR_DATE
  LEFT OUTER JOIN $$COMREFVWDB.R_FISCAL_MONTH_TO_YEAR RF
  ON MT.ANNUITY_MONTH=RF.FISCAL_YEAR_MONTH_INT 
  INNER JOIN $$SLSORDVWDB.MT_RSTD_BKGS_MEASURE BKGS 
  ON  
  BKGS.BOOKINGS_MEASURE_KEY   =    MT.BOOKINGS_MEASURE_KEY      
  AND BKGS.BKGS_MEASURE_TRANS_TYPE_CODE  =  MT.BKGS_MEASURE_TRANS_TYPE_CODE    
  AND BKGS.BOOKINGS_PROCESS_DATE      = MT.BOOKINGS_PROCESS_DATE        
  AND BKGS.SALES_TERRITORY_KEY = MT.SALES_TERRITORY_KEY
  AND BKGS.SALES_REP_NUMBER =  MT.SALES_REP_NUMBER


Post SQL : 



Target9 Name : WI_RSTD_BKGS_MSR_ANNUITY_81


Pre SQL : 
DELETE FROM $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY ;


Post SQL : 
COLLECT STATS ON $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY;


Source10 Name : SQ_9_MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 



SQL Query : 
SELECT 
 DV_FISCAL_YEAR_MONTH_INT  ,           
 MT.BOOKINGS_MEASURE_KEY ,
 MT.BKGS_MEASURE_TRANS_TYPE_CODE ,
 MT.BOOKINGS_PROCESS_DATE ,
 MT.SALES_TERRITORY_KEY,
 MT.SALES_REP_NUMBER,
 MT.SALES_ORDER_LINE_KEY,
 MT.DV_SALES_ORDER_LINE_KEY,
 MT.PRODUCT_KEY,
 MT.ADJUSTMENT_TYPE_CODE,
 MT.IDE_ADJUSTMENT_CODE IDE_ADJUSTMENT_CD,
 MT.ADJUSTMENT_CODE,
 MT.BILL_TO_CUSTOMER_KEY,
 MT.END_CUSTOMER_KEY,
 MT.SOLD_TO_CUSTOMER_KEY,
 MT.SHIP_TO_CUSTOMER_KEY,
 MT.DV_ATTRIBUTION_CD,
 MT.DV_REVENUE_RECOGNITION_FLG,
 MT.CORPORATE_BOOKINGS_FLG,
 MT.SERVICE_FLG,
 MT.RU_SERVICE_CONTRACT_START_DTM,
 MT.RU_SERVICE_CONTRACT_END_DTM,
 MT.DV_CONTRACT_DURATION,
 MT.DV_ANNUALIZED_FLG,
 DV_SRVC_BOOKINGS_TYPE ,
 MT.DV_ANNUITY_TYPE ,
 DV_ANNUITY_DATE                ,       
 DV_FISCAL_YEAR_ANNUITY_MTH_INT,
 MT.DV_ANNUITY_AMT,
 CURRENT_TIMESTAMP(0) EDW_CREATE_DTM,
 USER EDW_CREATE_USER,
 CURRENT_TIMESTAMP(0) EDW_UPDATE_DTM,
 USER EDW_UPDATE_USER,
 MT.CANCEL_CODE,
 MT.XCAT_FLG,
 MT.BK_OFFER_TYPE_NAME,
 MT.RECURRING_OFFER_FLG,
 MT.ELA_FLG,
 MT.DV_RECURRING_OFFER_CD,
 MT.SALES_MOTION_CD,
 MT.SUMMARY_QUOTE_FLG
 FROM 
 $$STGDB.WI_RSTD_BKGS_MSR_ANNUITY MT


Post SQL : 



Target10 Name : MT_RSTD_BKGS_MSR_ANNUITY


Pre SQL : 
DELETE FROM $$SLSORDVWDB.MT_RSTD_BKGS_MSR_ANNUITY MT 
  WHERE (MT.DV_FISCAL_YEAR_MONTH_INT,MT.BKGS_MEASURE_TRANS_TYPE_CODE) 
  IN (SELECT FISCAL_YEAR_MONTH_INT ,BKGS_MEASURE_TRANS_TYPE_CODE FROM $$STGDB.WI_ANNUITY_MONTH_CTRL_HIST)
  AND DV_SRVC_BOOKINGS_TYPE='ANNUITY'
  AND MT.SERVICE_FLG='Y';


Post SQL : 
CALL COLLECT_STATS_WRAP ('SLSORDDB','MT_RSTD_BKGS_MSR_ANNUITY','D') ;