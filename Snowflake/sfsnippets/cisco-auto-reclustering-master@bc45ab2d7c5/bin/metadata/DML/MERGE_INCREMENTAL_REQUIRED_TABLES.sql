-- This SQL will merge the incremental records with the core, driving data set.
-- It assumes a default driving mechanism, set of values, and batch id.
MERGE INTO CISCO_AUTO_RECLUSTER CORE
    USING CISCO_AUTO_RECLUSTER_INC INCR
    ON (
		CORE.ACCOUNT = INCR.ACCOUNT
			and
		CORE.DB_NAME = INCR.DB_NAME
			and
		CORE.SCHEMA_NAME = INCR.SCHEMA_NAME
			and
		CORE.TABLE_NAME = INCR.TABLE_NAME
		)
  WHEN NOT MATCHED THEN
    INSERT (
		  ACCOUNT
		, DB_NAME
		, SCHEMA_NAME
		, TABLE_NAME
		, RUN_SCHEDULE
		, DRIVING_MECH
		, TCPC
		, AVG_DEPTH
		, OTHER_DRIVER
		, MAX_RUNS
		, SIZE_OVERRIDE
		, WAREHOUSE_OVERRIDE
		, ACTIVE_FLAG
		, GROUP_NAME
		, PASSPHRASE
	)
    VALUES(
		  INCR.ACCOUNT
		, INCR.DB_NAME
		, INCR.SCHEMA_NAME
		, INCR.TABLE_NAME
		, 'DAILY'
		, 'AVG_DEPTH'
		, -999
		, 20
		, -999
		, 1
		, null
		, CASE
			WHEN INCR.DB_NAME like 'EDW_ADMIN%' then 'EDW_I_ADMIN_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_COLLAB%' then 'EDW_I_COLLAB_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_CPS%' then 'EDW_I_CPS_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_FINANCE%' then 'EDW_I_FINANCE_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_HR%' then 'EDW_I_HR_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_LEGAL%' then 'EDW_I_LEGAL_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_MASTER%' then 'EDW_I_MASTER_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_MKT%' then 'EDW_I_MKT_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_OPS%' then 'EDW_I_OPS_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_QLT%' then 'EDW_I_QLT_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_REF%' then 'EDW_I_REF_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_SALES%' then 'EDW_I_SALES_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_SC%' then 'EDW_I_SC_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_SECURITY%' then 'EDW_I_SECURITY_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_SERVICE%' then 'EDW_I_SERVICE_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_SW%' then 'EDW_I_SW_COMMON_WH'
			WHEN INCR.DB_NAME like 'EDW_TELMTRY%' then 'EDW_I_TELMTRY_COMMON_WH'
			else 'EDW_DATALAKE_WH'
		  END
		, 'YES'
		, 'DEFAULT_BATCH'
		, translate(dbms_random.string('a', 20), 'abcXYZ', '158249')
	)