-- Collect the login information from the eds repo IDed by a table. See EDS_DATA_CATALOG documentation for the ERD.
-- Note, access to decrypting passwords is predicated on knowledge of the oracle encoding passphrase
select
     TBL.ENVIRONMENT_NAME
   , TBL.DB_INSTANCE_NAME
   , TBL.DB_SCHEMA_NAME
   , TBL.TABLE_NAME
   , INST.DB_TYPE
   , PARAMS.PARAMETER_TYPE
   , PARAMS.PARAMETER_NAME
   , CASE
		WHEN PARAMS.PARAMETER_NAME = 'SOURCE_LOGIN_PASSWORD' THEN UTL_I18N.RAW_TO_CHAR(TO_CHAR(PARAMS.PARAMETER_VALUE), '$$METADATA_PASSWORD_DECRYPTION_PASSPHRASE')
        ELSE CAST(PARAMS.PARAMETER_VALUE AS VARCHAR2(1000 Char))
  END as PARAMETER_VALUE
FROM
	EDS_DATA_CATALOG.EDW_TABLE TBL
INNER JOIN
	EDS_DATA_CATALOG.EDW_DB_INSTANCE INST
	ON
		TBL.ENVIRONMENT_NAME = INST.ENVIRONMENT_NAME
	AND
		TBL.DB_INSTANCE_NAME = INST.DB_INSTANCE_NAME
INNER JOIN
	EDS_DATA_CATALOG.EDW_PARAMETER PARAMS
	ON
		PARAMS.ENVIRONMENT_NAME = INST.ENVIRONMENT_NAME
	AND
		PARAMS.PARAMETER_CATEGORY = INST.DB_TYPE
WHERE
        TBL.ENVIRONMENT_NAME = '$$ENVIRONMENT_NAME'
    and
        TBL.DB_INSTANCE_NAME = '$$DB_INSTANCE_NAME'
	and
		TBL.DB_SCHEMA_NAME = '$$DB_SCHEMA_NAME'
	and
		TBL.TABLE_NAME = '$$TABLE_NAME'
ORDER BY
    PARAMS.PARAMETER_TYPE